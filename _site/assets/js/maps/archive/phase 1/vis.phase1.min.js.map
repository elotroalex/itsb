{"version":3,"sources":["archive/phase 1/vis.phase1.js"],"names":["CreateMap","[object Object]","this","data","itineraries","trajectories","intersections","places","authors","author_names","continents","active_authors_t","width","window","innerWidth","height","innerHeight","loading","range","Date","date_start","date_end","d3","select","each","classed","self","mode","attr","ttime","_elem","filter","d","length","process_data","setup","generate","datasets","forEach","push","filepath","json","e","_d","loading_manager","keys","k","split","trim","join","toLowerCase","PlaceName","author_ids","AuthorID","selectAll","ui","dom","tabs","on","switch_mode","map","view","append","list","html","generateAuthorList","svg","route_change","enter","text","left_svg","right_svg","tear_down","generate_int_map","generate_traj_map","generate_routes","focus","event","stopPropagation","unfocus","generate_sidebar","sliderwidth","dateslider","offsetWidth","scale","time","domain","scale_axis","axis","orient","ticks","tickSize","tickPadding","slide","slider","value","scale_value_converter","orientation","margin","animate","evt","v_1","v_2","update_datebar","update","_val","s","nice","month","invert","call","intersections_unique","points_target","points_g","points_backs","points_03","points_02","points_01","projection","geo","mercator","translate","offsetHeight","path","features","topojson","feature","objects","filter_data","holder","entries","n","key","figures","__d","Likelihood","lists","i","Object","toString","values","t","EndDate","generate_points","r_scale","linear","exit","remove","p","Long","Lat","transition","duration","_01","r_tot","parentNode","__data__","_02","_03","o_scale","results","title","items","items_date","indexOf","style","StartDate","f","format","elem","index","splice","console","log","trajectories_unique","lines_target","lines_g","lines","author","b","info","PlaceID","tier","j","PlaceID_End","Likelihood_End","generate_lines","source","target","p_1","p_2","dx","dy","dr","Math","sqrt","tooltip","StartCitation","_side","curr_svg","author_name","property","author_id","visH","starts","ends","min","max","earliest_date","latest_date","route_scale","route_g","route_line_background","route_labels","route_line","route_points","route_stops","route_point_labels","t1","t2","_id","opp","vis","get_data","selection","prototype","first","last","size"],"mappings":"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","file":"../../../archive/phase 1/vis.phase1.min.js","sourcesContent":["/* global d3 */\r\n/* global ui */\r\n\r\nclass CreateMap {\r\n\t\r\n\tconstructor(){\r\n\t\tthis.data = {};\r\n\r\n\t\tthis.itineraries = {};\r\n\t\tthis.trajectories = {};\r\n\t\tthis.intersections = {};\r\n\t\tthis.places = {};\r\n\t\tthis.authors = {};  // {author_id: author_name}\r\n    this.author_names = {}; // {author_name: author_id}\r\n\t\tthis.continents = {};\r\n\t\tthis.active_authors_t = [];\r\n\r\n\t\t//store screen height and width\r\n\t\tthis.width = window.innerWidth;\r\n\t\tthis.height = window.innerHeight;\r\n\r\n\t\tthis.loading = [];\r\n\r\n\t\tthis.range = [\r\n\t\t\tnew Date(1890,1,1),\r\n\t\t\tnew Date(2010,1,1)\r\n\t\t];\r\n\t\tthis.date_start = this.range[0];\r\n\t\tthis.date_end = this.range[1];\r\n\r\n\t\t/* Modes: (1) Intersections, (2) Trajectories, (3) Itineraries */\r\n\t\t\r\n\t\td3.select('.panel').each(function(){\r\n  \t\tif (d3.select(this).classed('selected')){\r\n    \t\tself.mode = d3.select(this).attr('data-mode');\r\n  \t\t}\r\n\t\t});\r\n\r\n\t\tthis.ttime = 45;\r\n\t}\r\n\r\n\tloading_manager(_elem){\r\n\t\tvar self = this;\r\n\t\t\r\n\t\t//remove name of retrieved JSON document from loading array\r\n\t\tself.loading = self.loading.filter(function(d){ return d !== _elem; });\r\n\r\n\t\tif(self.loading.length === 0){\r\n\t\t\tself.process_data();\r\n\t\t\tself.setup();\r\n\t\t\tself.generate();\r\n\t\t}\r\n\t}\r\n\r\n\tget_data(){\r\n\t\tvar self = this;\r\n\t\tvar datasets = ['author_ids','intersections','itineraries','places','continents'];\r\n\r\n\t\tdatasets.forEach(function(d){ self.loading.push(d); });\r\n\t\tdatasets.forEach(function(d){\r\n\r\n\t\t\tvar filepath = 'data/three_' +d +'.json';\r\n\r\n\t\t\td3.json(filepath,function(e,_d){\r\n\t\t\t\tif(!e){\r\n\t\t\t\t\tself.data[d] = _d;\r\n\t\t\t\t\tself.loading_manager(d);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tprocess_data(){\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tself.continents = self.data.continents;\r\n\r\n\t\t//WEAKPOINT ** fix later\r\n\t\t//places\r\n\t\td3.keys(self.data.places).forEach(function(d){\r\n\t\t\tvar k = d.split(',');\r\n\t\t\tk[0] = k[0].trim().split(' ').join('-');\r\n\t\t\tk[1] = k[1].trim().split(' ').join('-');\r\n\t\t\tk = k.join('_').toLowerCase();\r\n\t\t\tself.places[k] = self.data.places[d];\r\n\t\t\tself.places[k].PlaceName = d;\r\n\t\t});\r\n\r\n\t\t//authors\r\n\t\td3.keys(self.data.author_ids).forEach(function(k){\r\n\t\t\tself.authors[self.data.author_ids[k]] = k;\r\n      self.author_names[k] = self.data.author_ids[k];\r\n\t\t});\r\n\t\t\r\n\t\t//intersections\r\n\t\tself.intersections = self.data.intersections;\r\n\r\n\t\t//trajectories\r\n\t\tself.trajectories = {};\r\n\r\n\t\t//itineraries\r\n\t\tself.itineraries = {};\r\n\t\td3.keys(self.authors).forEach(function(d){\r\n\t\t\tif(!self.itineraries[d]){ self.itineraries[d] = []; }\r\n\t\t});\r\n\t\td3.keys(self.data.itineraries).forEach(function(d){\r\n\t\t\tself.data.itineraries[d].forEach(function(_d){\r\n\t\t\t\tself.itineraries[_d.AuthorID].push(_d);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tsetup(){\r\n\t\tvar self = this;\r\n\r\n    /* Switch modes when tabs are clicked  */\r\n    \r\n\t\td3.selectAll(ui.dom.tabs).each(function() {\r\n  \t\td3.select(this).on('click',function() {\r\n    \t\tself.switch_mode(d3.select(this).attr('data-mode'));\r\n  \t\t});\r\n\t\t});\r\n\t\t\r\n\t\t// Intersections setup\r\n\t\t\r\n\t\tthis.intersections.map = d3.select(ui.dom.intersections.map.view)\r\n\t\t  .append('svg')\r\n\t\t  .attr('width','100%');\r\n\t\t  \r\n    // Trajectories setup\r\n    \r\n\t\tthis.trajectories.map = d3.select(ui.dom.trajectories.map.view)\r\n\t\t  .append('svg')\r\n\t\t  .attr('width','100%');\r\n        \r\n    d3.select(ui.dom.trajectories.authors.list)\r\n      .html(ui.generateAuthorList(this));\r\n        \r\n\t\tthis.svg = d3.select('#container')\r\n\t\t\t.append('svg')\r\n\t\t\t.attr('width',this.width);\r\n\r\n        // Create left figure drop-down selector\r\n        d3.select('#left_itinerary')\r\n            .append('select')\r\n            .attr('id','left_select')\r\n            .on('change', function(){ self.route_change('left'); })\r\n            .selectAll('option')\r\n            .data(d3.keys(self.author_names)).enter()\r\n            .append('option')\r\n            .text(function (d) { return d; });\r\n\r\n        // Create right figure drop-down selector\r\n        d3.select('#right_itinerary')\r\n            .append('select')\r\n            .attr('id', 'right_select')\r\n            .on('change', function(){ self.route_change('right'); })\r\n            .selectAll('option')\r\n            .data(d3.keys(self.author_names)).enter()\r\n            .append('option')\r\n            .text(function (d) { return d; });\r\n\r\n        // Create left div for figure route\r\n        this.left_svg = d3.select('#left_itinerary')\r\n            .append('svg') //WAS \"DIV\"\r\n            .attr('id', 'left_route');\r\n\r\n        // Create right div for figure route\r\n        this.right_svg = d3.select('#right_itinerary')\r\n            .append('svg') //WAS \"DIV\"\r\n            .attr('id', 'right_route');\r\n\r\n        // Update left route and right route to show route for current figure\r\n        self.route_change('left');\r\n        self.route_change('right');\r\n        \r\n        \r\n\t}\r\n\r\n\tgenerate(){\r\n    this.tear_down();\r\n    \r\n    switch(this.mode) {\r\n      case 1:\r\n      default:\r\n        this.generate_int_map();\r\n        break;\r\n      case 2:\r\n        this.generate_traj_map(); // TO DO: New function for trajectories\r\n        break;\r\n      case 3:\r\n        this.generate_routes();\r\n    }\r\n\t}\r\n\t\r\n\t/* !INTERSECTIONS MAP FUNCTION */\r\n\r\n\tgenerate_int_map(){\r\n\t\tvar self = this;\r\n\t\tvar focus = false;\r\n\t\t//var sidebar_tabs = d3.selectAll('.sidebar_tab'),\r\n\t\t\t//\tsidebar_mode = 1;\r\n\r\n\t\tthis.intersections.map.attr('height',this.height);\r\n\r\n\t\t//click handlers\r\n\t\tthis.intersections.map.on('click',function(){\r\n\t\t\td3.event.stopPropagation();\r\n\t\t\tunfocus();\r\n\t\t\tgenerate_sidebar();\r\n\t\t});\r\n\t\t\r\n\t\t//slider\r\n\t\t\r\n\t\tvar sliderwidth = ui.dom.intersections.dateslider.offsetWidth;\r\n\t\t\r\n\t\tvar scale = d3.time.scale()\r\n\t\t\t.domain(this.range);\r\n\t\t\t\t\t\r\n\t\tvar scale_axis = d3.svg.axis()\r\n\t\t\t.orient('right')\r\n\t\t\t.ticks(10)\r\n\t\t\t.tickSize(sliderwidth - 2) //takes into account a 2px border\r\n\t\t\t.tickPadding(12);\r\n\t\t\t\r\n\t\tvar slide = d3.slider()\r\n\t\t\t.scale(scale)\r\n\t\t\t.axis(scale_axis)\r\n\t\t\t.value([\r\n\t\t\t\tscale_value_converter(this.range[1]),\r\n\t\t\t\tscale_value_converter(this.range[0])\r\n\t\t\t])\r\n\t\t\t.orientation('vertical')\r\n\t\t\t.margin(0)\r\n\t\t\t.animate(false)\r\n\t\t\t.on('slide',function(evt,value){\r\n\t\t\t\tvar v_1 = value[1] instanceof Date ? value[1] : new Date(value[1]),\r\n\t\t\t\t\t\tv_2 = value[0] instanceof Date ? value[0] : new Date(value[0]);\r\n\t\t\t\t\r\n\t\t\t\tself.date_start = scale_value_converter(v_1);\r\n\t\t\t\tself.date_end = scale_value_converter(v_2);\r\n\r\n\t\t\t\t// unfocus();\r\n\t\t\t\tupdate_datebar();\r\n\t\t\t\tupdate();\r\n\t\t\t})\r\n\t\t\t.on('slideend',function(evt,value){\r\n\t\t\t\tupdate();\r\n\t\t\t});\r\n\t\t\t\r\n\r\n\t\t//the slider library, though lightweight, is flawed\r\n\t\t//use this to convert the date values properly\r\n\t\tfunction scale_value_converter(_val){\r\n\t\t\tvar s = d3.time.scale()\r\n\t\t\t\t.domain(scale.domain())\r\n\t\t\t\t.range([0,self.height])\r\n\t\t\t\t.nice(d3.time.month)\r\n\t\t\t\t;\r\n\t\t\treturn s.invert((self.height -(s(_val))));\r\n\t\t}    \r\n\r\n\t\tvar slider = d3.select(ui.dom.intersections.dateslider).call(slide);\r\n\t\t\r\n\t\td3.select(ui.dom.intersections.dateslider).selectAll('text').attr(\"transform\", \"translate(-\" + sliderwidth + \",20)\").text(function(d){\r\n  \t\treturn d3.select(this).text() + \"s\";\r\n\t\t});\r\n\t\t\r\n\t\tupdate_datebar();\r\n\t\t\t\t\r\n\t\t//map\r\n\t\tvar projection = d3.geo.mercator()\r\n\t\t\t.scale(180)\r\n\t\t\t.translate([ui.dom.intersections.map.view.offsetWidth * 0.5,ui.dom.intersections.map.view.offsetHeight * 0.5]);\r\n\t\t\t\r\n\t\tvar path = d3.geo.path().projection(projection);\r\n\r\n\t\tvar features = topojson.feature(self.continents,self.continents.objects.continents);\r\n\t\tvar intersections,\r\n\t\t\t\tintersections_unique;\r\n\t\tvar points_target,\r\n\t\t\t\tpoints_g,\r\n\t\t\t\tpoints_backs,\r\n\t\t\t\tpoints_03,\r\n\t\t\t\tpoints_02,\r\n\t\t\t\tpoints_01;\r\n\r\n\t\t//draw vector map\r\n\t\tvar map;\r\n\t\tmap = self.intersections.map.selectAll('path.map')\r\n\t\t\t.data([features]);\r\n\t\tmap.enter().append ('path')\r\n\t\t\t.classed('map',true);\r\n\t\tmap\r\n\t\t\t.attr('d',path);\r\n\t\tmap.exit().remove();\r\n\r\n\t\tfunction filter_data(){\r\n\r\n\t\t\t//clear objects\r\n\t\t\tintersections = {};\r\n\t\t\tintersections_unique = {};\r\n\t\t\t\r\n\r\n\t\t\t//INTERSECTIONS\r\n\t\t\t//filter by date range\r\n\t\t\tvar holder = d3.entries(self.intersections).filter(function(d){\r\n\t\t\t\tvar n = new Date(d.key);\r\n\t\t\t\treturn n >=self.date_start && n <=self.date_end;\r\n\t\t\t});\r\n\t\t\t//get distinct places\r\n\t\t\t//slot author IDs into place\r\n\t\t\t//highest likelihood score wins\r\n\t\t\tholder.forEach(function(d){\r\n\t\t\t\tif(d3.keys(d.value).length >0){\r\n\t\t\t\t\td3.keys(d.value).forEach(function(_d){\r\n\t\t\t\t\t\tif(!intersections[_d]){ \r\n\t\t\t\t\t\t\tintersections[_d] = {}; \r\n\t\t\t\t\t\t\tintersections[_d].figures = {}; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\td.value[_d].forEach(function(__d){\r\n\t\t\t\t\t\t\tif(!intersections[_d].figures[__d.AuthorID] || intersections[_d].figures[__d.AuthorID] >__d.Likelihood){\r\n\t\t\t\t\t\t\t\tintersections[_d].figures[__d.AuthorID] = __d.Likelihood;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//tally up totals\r\n\t\t\t\r\n\t\t\t// Assigns intersections lists dynamically\r\n\t\t\t\r\n\t\t\td3.keys(intersections).forEach(function(d){\r\n\t\t\t\tintersections[d].lists = {};\r\n\t\t\t  for(var i=1;i <= Object.keys(self.authors).length; i++) {\r\n  \t\t\t\tvar key = \"_0\" + i.toString();\r\n  \t\t\t\tintersections[d].lists[key] = d3.values(intersections[d].figures).filter(function(_d){ return _d === i; });\r\n        }\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//make list of unique intersections per place\r\n\t\t\tholder.forEach(function(d){\r\n\t\t\t\td3.keys(d.value).forEach(function(_d){\r\n\t\t\t\t\tif(!intersections_unique[_d]){ intersections_unique[_d] = []; }\r\n\t\t\t\t\td.value[_d].forEach(function(__d){\r\n\t\t\t\t\t\tif(intersections_unique[_d].filter(function(t){ return t.AuthorID === __d.AuthorID && t.EndDate === __d.EndDate; }).length === 0){\r\n\t\t\t\t\t\t\tintersections_unique[_d].push(__d);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tfunction generate_points(){\r\n  \t\t\r\n\t\t\t//scale for radii\r\n\t\t\tvar r_scale = d3.scale.linear()\r\n\t\t\t\t.domain([0,10])\r\n\t\t\t\t.range([0,36]);\r\n\r\n\t\t\tpoints_target = self.intersections.map.selectAll('g.points_target')\r\n\t\t\t\t.data([self]);\r\n\t\t\tpoints_target.enter().append('g')\r\n\t\t\t\t.classed('points_target',true);\r\n\t\t\tpoints_target.exit().remove();\r\n\r\n\t\t\tpoints_g = self.intersections.map.selectAll('g.points_g')\r\n\t\t\t\t.data(d3.entries(intersections));\r\n\t\t\tpoints_g.enter().append('g')\r\n\t\t\t\t.classed('points_g',true);\r\n\t\t\tpoints_g\r\n\t\t\t\t.attr('transform',function(d){\r\n  \t\t\t\t\r\n\t\t\t\t\tvar p  = projection([\r\n\t\t\t\t\t\t\t\tself.places[d.key].Long,\r\n\t\t\t\t\t\t\t\tself.places[d.key].Lat\r\n\t\t\t\t\t\t\t]),\r\n\t\t\t\t\t\t\tpx = p[0],\r\n\t\t\t\t\t\t\tpy = p[1];\r\n\t\t\t\t\treturn 'translate(' +px +',' +py +')';\r\n\t\t\t\t})\r\n\t\t\t\t.append('title')\r\n\t\t\t\t.text(function(d){\r\n  \t\t\t\treturn self.places[d.key].PlaceName;\r\n\t\t\t\t});\r\n\t\t\tpoints_g\r\n\t\t\t\t.on('mousemove',function(d){\r\n\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t.duration(self.ttime)\r\n\t\t\t\t\t\t.attr('transform',function(_d){\r\n\t\t\t\t\t\t\tvar p  = projection([\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\r\n\t\t\t\t\t\t\t\t\t]),\r\n\t\t\t\t\t\t\t\t\tpx = p[0],\r\n\t\t\t\t\t\t\t\t\tpy = p[1];\r\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1.5)';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.on('mouseout',function(d){\r\n\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t.duration(self.ttime/2)\r\n\t\t\t\t\t\t.attr('transform',function(_d){\r\n\t\t\t\t\t\t\tvar p  = projection([\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\r\n\t\t\t\t\t\t\t\t\t]),\r\n\t\t\t\t\t\t\t\t\tpx = p[0],\r\n\t\t\t\t\t\t\t\t\tpy = p[1];\r\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1)';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.on('click',function(d){\r\n\t\t\t\t\td3.event.stopPropagation();\r\n\t\t\t\t\tunfocus();\r\n\t\t\t\t\tif(d.key !== focus.key){\r\n\t\t\t\t\t\tfocus = d;\r\n\t\t\t\t\t\td3.select(this).classed('focus_point',true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgenerate_sidebar();\r\n\t\t\t\t});\r\n\t\t\tpoints_g.exit().remove();\r\n\r\n\t\t\t//circlebacks (most certain size)\r\n\t\t\tpoints_backs = points_g.selectAll('circle.point_back')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\r\n\t\t\tpoints_backs.enter().append('circle')\r\n\t\t\t\t.classed('point_back',true);\r\n\t\t\tpoints_backs\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._02.length +this.parentNode.__data__.value.lists._03.length;\r\n\t\t\t\t\treturn r_scale(r_tot);\r\n\t\t\t\t});\r\n\t\t\tpoints_backs.exit().remove();\r\n\r\n\t\t\t//least certain\r\n\t\t\tpoints_01 = points_g.selectAll('circle.point_01')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\r\n\t\t\tpoints_01.enter().append('circle')\r\n\t\t\t\t.classed('point_01',true);\r\n\t\t\tpoints_01\r\n\t\t\t\t.classed('point',true)\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._02.length +this.parentNode.__data__.value.lists._03.length;\r\n\t\t\t\t\treturn r_scale(r_tot);\r\n\t\t\t\t});\r\n\t\t\tpoints_01.exit().remove();\r\n\t\t\t\t\r\n\t\t\t//certain\r\n\t\t\tpoints_02 = points_g.selectAll('circle.point_02')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._02]; });\r\n\t\t\tpoints_02.enter().append('circle')\r\n\t\t\t\t.classed('point_02',true);\r\n\t\t\tpoints_02\r\n\t\t\t\t.classed('point',true)\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){ \r\n\t\t\t\t\tvar r_tot = d.length +this.parentNode.__data__.value.lists._03.length;\r\n\t\t\t\t\treturn r_scale(r_tot);\r\n\t\t\t\t});\r\n\t\t\tpoints_02.exit().remove();\r\n\t\t\t\t\r\n\t\t\t//most certain\r\n\t\t\tpoints_03 = points_g.selectAll('circle.point_03')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._03]; });\r\n\t\t\tpoints_03.enter().append('circle')\r\n\t\t\t\t.classed('point_03',true);\r\n\t\t\tpoints_03\r\n\t\t\t\t.classed('point',true)\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar r_tot = d.length;\r\n\t\t\t\t\treturn r_scale(r_tot);\r\n\t\t\t\t});\r\n\t\t\tpoints_03.exit().remove();\r\n\t\t}\r\n\r\n\t\tfunction generate_sidebar(){\r\n\t\t\tvar o_scale = d3.scale.linear()\r\n\t\t\t\t.domain([0,3])\r\n\t\t\t\t.range([0.5,1]);\r\n\r\n\t\t\tif(focus){\r\n\t\t\t\td3.select(ui.dom.intersections.results.title).html(self.places[focus.key].PlaceName);\r\n\r\n\t\t\t\t//var data = sidebar_mode === 1 ? (intersections_unique[focus.key] || []) : (trajectories_unique[focus.key]);\r\n\t\t\t\tvar data = (intersections_unique[focus.key] || []);\r\n\t\t\t\tvar items_target = d3.select(ui.dom.intersections.results.view);\r\n\t\t\t\tvar items,\r\n\t\t\t\t\t\titems_date;\r\n\r\n\t\t\t\titems = items_target.selectAll('.item')\r\n\t\t\t\t\t.data(data);\r\n\t\t\t\titems.enter().append('div')\r\n\t\t\t\t\t.classed('item',true);\r\n\t\t\t\titems\r\n\t\t\t\t\t.attr('class',function(d){\r\n\t\t\t\t\t\tvar idx = d3.keys(self.authors).indexOf(d.AuthorID);\r\n\t\t\t\t\t\treturn 'item id_' +idx;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.style('opacity',function(d){\r\n\t\t\t\t\t\treturn o_scale(d.Likelihood);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.html(function(d){\r\n\t\t\t\t\t\treturn self.authors[d.AuthorID];\r\n\t\t\t\t\t});\r\n\t\t\t\titems.exit().remove();\r\n\r\n\t\t\t\titems_date = items.selectAll('div.item_date')\r\n\t\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\t\titems_date.enter().append('div')\r\n\t\t\t\t\t.classed('item_date',true);\r\n\t\t\t\titems_date\r\n\t\t\t\t\t.html(function(d){\r\n\t\t\t\t\t\tvar str;\r\n\t\t\t\t\t\tstr = d.StartDate && d.EndDate ? d.StartDate +'&nbsp;&ndash;&nbsp;' +d.EndDate : d.StartDate ? d.StartDate +'&nbsp;&ndash;' : d.EndDate ? '&nbsp;&ndash;' +d.EndDate : '';\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t/* // Trajectory code\r\n\t\t\t\t\t\t\tvar a1 = d.PlaceID === focus.key ? 'accent' : '',\r\n\t\t\t\t\t\t\t\t\ta2 = d.PlaceID_End && d.PlaceID_End === focus.key ? 'accent' : '';\r\n\t\t\t\t\t\t\tvar p1 = '<span class=\"_' +d.Likelihood +' ' +a1 +'\">' +self.places[d.PlaceID].PlaceName +'</span>',\r\n\t\t\t\t\t\t\t\t\tp2 = '<span class=\"_' +d.Likelihood_End +' ' +a2 +'\">' +(d.PlaceID_End ? self.places[d.PlaceID_End].PlaceName : '') +'</span>';\r\n\t\t\t\t\t\t\tstr = '<div class=\"b\">' +(d.EndDate || '') +'</div><div>' +p1 +'&nbsp;&rarr;&nbsp;' +p2 +'</div>';\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\treturn str;\r\n\t\t\t\t\t});\r\n\t\t\t\titems_date.exit().remove();\r\n\r\n\t\t\t} else{\r\n\t\t\t\td3.select('#sidebar_title').html('');\r\n\t\t\t\td3.select('#sidebar_items').html('');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction update_datebar(){\r\n\t\t\tvar f = d3.time.format('%b. %Y');\r\n\t\t\td3.select('#date_start').html(f(self.date_start));\r\n\t\t\td3.select('#date_end').html(f(self.date_end));\r\n\t\t}\r\n\r\n\t\tfunction update(){\r\n\t\t\tfilter_data();\r\n\t\t\tgenerate_points();\r\n\t\t\tgenerate_sidebar();\r\n\t\t}\r\n\r\n\t\tfunction unfocus(){\r\n\t\t\tfocus = false;\r\n\t\t\td3.selectAll('.focus_point').classed('focus_point',false);\r\n\t\t}\r\n\r\n\t\tfilter_data();\r\n\t\tgenerate_points();\r\n\t\tgenerate_sidebar();\r\n\t}\r\n\t\r\n\t/* !TRAJECTORIES MAP FUNCTION */\r\n\t\r\n\tgenerate_traj_map(){\r\n  \t  \t\r\n\t\tvar self = this;\r\n\t\tvar focus = false;\r\n\r\n\t\tthis.trajectories.map.attr('height',this.height);\r\n\r\n\t\t//click handlers\r\n\t\tthis.trajectories.map.on('click',function(){\r\n\t\t\td3.event.stopPropagation();\r\n\t\t\tunfocus();\r\n\t\t\tgenerate_sidebar();\r\n\t\t});\r\n\t\t\r\n\t\t// Manage active trajectory map authors\r\n\t\t\r\n    d3.select(ui.dom.trajectories.authors.list)\r\n      .selectAll('.author').each(function(){\r\n        d3.select(this).on('click',function(){\r\n          var elem = d3.select(this);          \r\n          if (elem.classed('selected')) { // remove item from active list\r\n            elem.classed('selected',false);\r\n            var index = self.active_authors_t.indexOf(elem.attr('data-key'));\r\n            if (index > -1) {\r\n              self.active_authors_t.splice(index,1);\r\n            }\r\n          } else {\r\n            elem.classed('selected',true);\r\n            self.active_authors_t.push(elem.attr('data-key'));\r\n          }\r\n          \r\n          update();\r\n        });\r\n      });\r\n      \r\n\t\t//slider\r\n\t\t\r\n\t\tvar sliderwidth = ui.dom.trajectories.dateslider.offsetWidth;\r\n\t\t\r\n\t\tconsole.log(sliderwidth);\r\n\t\t\r\n\t\tvar scale = d3.time.scale()\r\n\t\t\t.domain(this.range);\r\n\t\t\t\t\t\r\n\t\tvar scale_axis = d3.svg.axis()\r\n\t\t\t.orient('right')\r\n\t\t\t.ticks(10)\r\n\t\t\t.tickSize(sliderwidth - 2) //takes into account a 2px border\r\n\t\t\t.tickPadding(12);\r\n\t\t\t\r\n\t\tvar slide = d3.slider()\r\n\t\t\t.scale(scale)\r\n\t\t\t.axis(scale_axis)\r\n\t\t\t.value([\r\n\t\t\t\tscale_value_converter(this.range[1]),\r\n\t\t\t\tscale_value_converter(this.range[0])\r\n\t\t\t])\r\n\t\t\t.orientation('vertical')\r\n\t\t\t.margin(0)\r\n\t\t\t.animate(false)\r\n\t\t\t.on('slide',function(evt,value){\r\n\t\t\t\tvar v_1 = value[1] instanceof Date ? value[1] : new Date(value[1]),\r\n\t\t\t\t\t\tv_2 = value[0] instanceof Date ? value[0] : new Date(value[0]);\r\n\t\t\t\t\r\n\t\t\t\tself.date_start = scale_value_converter(v_1);\r\n\t\t\t\tself.date_end = scale_value_converter(v_2);\r\n\r\n\t\t\t\t// unfocus();\r\n\t\t\t\tupdate_datebar();\r\n\t\t\t\tupdate();\r\n\t\t\t})\r\n\t\t\t.on('slideend',function(evt,value){\r\n\t\t\t\tupdate();\r\n\t\t\t});\r\n\t\t\t\r\n\r\n\t\t//the slider library, though lightweight, is flawed\r\n\t\t//use this to convert the date values properly\r\n\t\tfunction scale_value_converter(_val){\r\n\t\t\tvar s = d3.time.scale()\r\n\t\t\t\t.domain(scale.domain())\r\n\t\t\t\t.range([0,self.height])\r\n\t\t\t\t.nice(d3.time.month)\r\n\t\t\t\t;\r\n\t\t\treturn s.invert((self.height -(s(_val))));\r\n\t\t}    \r\n\r\n\t\tvar slider = d3.select(ui.dom.trajectories.dateslider).call(slide);\r\n\t\t\r\n\t\td3.select(ui.dom.trajectories.dateslider).selectAll('text').attr(\"transform\", \"translate(-\" + sliderwidth + \",20)\");\r\n\t\t\r\n\t\tupdate_datebar();\r\n\t\t\t\t\r\n\t\t//map\r\n\t\tvar projection = d3.geo.mercator()\r\n\t\t\t.scale(180)\r\n\t\t\t.translate([ui.dom.trajectories.map.view.offsetWidth * 0.5,ui.dom.trajectories.map.view.offsetHeight * 0.5]);\r\n\t\t\t\r\n\t\tvar path = d3.geo.path().projection(projection);\r\n\r\n\t\tvar features = topojson.feature(self.continents,self.continents.objects.continents);\r\n\t\tvar intersections,\r\n\t\t\t\tintersections_unique,\r\n\t\t\t\ttrajectories,\r\n\t\t\t\ttrajectories_unique;\r\n\t\tvar points_target,\r\n\t\t\t\tpoints_g,\r\n\t\t\t\tpoints_backs,\r\n\t\t\t\tpoints_03,\r\n\t\t\t\tpoints_02,\r\n\t\t\t\tpoints_01,\r\n\r\n\t\t\t\tlines_target,\r\n\t\t\t\tlines_g,\r\n\t\t\t\tlines;\r\n\r\n\t\t//draw vector map\r\n\t\tvar map;\r\n\t\tmap = self.trajectories.map.selectAll('path.map')\r\n\t\t\t.data([features]);\r\n\t\tmap.enter().append ('path')\r\n\t\t\t.classed('map',true);\r\n\t\tmap\r\n\t\t\t.attr('d',path);\r\n\t\tmap.exit().remove();\r\n\r\n\t\tfunction filter_data(){\r\n  \t\t  \t\t\r\n\t\t\t//clear objects\r\n\t\t\tintersections = {};\r\n\t\t\tintersections_unique = {};\r\n\t\t\ttrajectories = {};\r\n\t\t\ttrajectories_unique = {};\r\n\t\t\t\r\n\t\t\t//INTERSECTIONS\r\n\t\t\t//filter by date range\r\n\t\t\tvar holder = d3.entries(self.intersections).filter(function(d){  \t\t\t\r\n\t\t\t\tvar n = new Date(d.key);\r\n\t\t\t\treturn n >=self.date_start && n <=self.date_end;\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t//get distinct places\r\n\t\t\t//slot author IDs into place\r\n\t\t\t//highest likelihood score wins\r\n\t\t\tholder.forEach(function(d){\r\n\t\t\t\tif(d3.keys(d.value).length >0){\r\n\t\t\t\t\td3.keys(d.value).forEach(function(_d){  // _d is city key\r\n  \t\t\t\t\t\r\n  \t\t\t\t\t\r\n  \t\t\t\t\t// Check to see if there is at least 1 valid author\r\n  \t\t\t\t\tvar b = 0;\r\n  \t\t\t\t\t\r\n            d.value[_d].forEach(function(__d){\r\n              if (self.active_authors_t.indexOf(__d.AuthorID) > -1) {\r\n                b++;\r\n              }\r\n            });\r\n                        \r\n            if (b==0) { return; }\r\n  \t\t\t\t\t\r\n  \t\t\t\t\t// Create entry\r\n  \t\t\t\t\t\r\n\t\t\t\t\t\tif(!intersections[_d]){ \r\n\t\t\t\t\t\t\tintersections[_d] = {}; \r\n\t\t\t\t\t\t\tintersections[_d].figures = {}; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t    // Only add valid authors\r\n\t\t\t\t    \t\t\r\n\t\t\t\t\t\td.value[_d].forEach(function(__d){\r\n\t\t\t\t\t\t\tif((!intersections[_d].figures[__d.AuthorID] || intersections[_d].figures[__d.AuthorID] >__d.Likelihood) && self.active_authors_t.indexOf(__d.AuthorID) > -1){\r\n\t\t\t\t\t\t\t\tintersections[_d].figures[__d.AuthorID] = __d.Likelihood;\r\n\t\t\t\t\t\t\t\tintersections[_d].info = d.value[_d];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//tally up totals\r\n\t\t\t\r\n\t\t\t// Assigns intersections lists dynamically\r\n\t\t\t\r\n\t\t\td3.keys(intersections).forEach(function(d){\r\n\t\t\t\tintersections[d].lists = {};\r\n\t\t\t  for(var i=1;i <= Object.keys(self.authors).length; i++) {\r\n  \t\t\t\tvar key = \"_0\" + i.toString();\r\n  \t\t\t\tintersections[d].lists[key] = d3.values(intersections[d].figures).filter(function(_d){ return _d === i; });\r\n        }\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t//make list of unique intersections per place\r\n\t\t\tholder.forEach(function(d){\r\n\t\t\t\td3.keys(d.value).forEach(function(_d){\r\n\t\t\t\t\tif(!intersections_unique[_d]){ intersections_unique[_d] = []; }\r\n\t\t\t\t\td.value[_d].forEach(function(__d){\r\n\t\t\t\t\t\tif(intersections_unique[_d].filter(function(t){ return t.AuthorID === __d.AuthorID && t.EndDate === __d.EndDate; }).length === 0){\r\n\t\t\t\t\t\t\tintersections_unique[_d].push(__d);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t//TRAJECTORIES\r\n\t\t\tholder.forEach(function(d){\r\n\t\t\t\td3.keys(d.value).forEach(function(_d){\r\n\t\t\t\t\td.value[_d].forEach(function(__d){\r\n\t\t\t\t\t\tif(!trajectories[__d.AuthorID]){ trajectories[__d.AuthorID] = []; }\r\n\t\t\t\t\t\tif(trajectories[__d.AuthorID].filter(function(t){ return t.PlaceID === __d.PlaceID && t.EndDate === __d.EndDate; }).length === 0){\r\n\t\t\t\t\t\t\ttrajectories[__d.AuthorID].push(__d);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n      for (var author in trajectories) {\r\n       if (self.active_authors_t.indexOf(author) == -1) {\r\n         delete trajectories[author];\r\n       } \r\n      }\r\n                  \r\n\t\t\t//pair up start and end points\r\n\t\t\tvar tier = 0;\r\n\t\t\tfor(var i=0; i<d3.keys(trajectories).length; i++){\r\n\t\t\t\tfor(var j=0; j<trajectories[d3.keys(trajectories)[i]].length -1; j++){\r\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].PlaceID_End = trajectories[d3.keys(trajectories)[i]][j+1].PlaceID;\r\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].Likelihood_End = trajectories[d3.keys(trajectories)[i]][j+1].Likelihood;\r\n\t\t\t\t\ttrajectories[d3.keys(trajectories)[i]][j].tier = tier;\r\n\t\t\t\t\ttier=(j%2)*10;\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t//make list of unique trajectories per place\r\n\t\t\td3.keys(intersections).forEach(function(d){\r\n\t\t\t\tif(!trajectories_unique[d]){ trajectories_unique[d] = []; }\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\td3.values(trajectories).forEach(function(d){\r\n\t\t\t\td.forEach(function(_d){ \r\n\t\t\t\t\tif(!trajectories_unique[_d.PlaceID]){ trajectories_unique[_d.PlaceID] = []; }\r\n\t\t\t\t\tif(!trajectories_unique[_d.PlaceID_End]){ trajectories_unique[_d.PlaceID_End] = []; }\r\n\t\t\t\t\ttrajectories_unique[_d.PlaceID].push(_d);\r\n\t\t\t\t\tif(_d.PlaceID_End){ trajectories_unique[_d.PlaceID_End].push(_d); }\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t}\r\n\r\n\t\tfunction generate_lines(){\r\n\r\n\t\t\tlines_target = self.trajectories.map.selectAll('g.lines_target')\r\n\t\t\t\t.data([self]);\r\n\t\t\tlines_target.enter().append('g')\r\n\t\t\t\t.classed('lines_target',true);\r\n\t\t\tlines_target.exit().remove();\r\n\r\n\t\t\tlines_g = lines_target.selectAll('g.lines_g')\r\n\t\t\t\t.data(d3.entries(trajectories));\r\n\t\t\tlines_g.enter().append('g')\r\n\t\t\t\t.classed('lines_g',true);\r\n\t\t\tlines_g\r\n\t\t\t\t.attr('class',function(d){\r\n\t\t\t\t\treturn 'lines_g id_' +d3.keys(self.authors).indexOf(d.key);\r\n\t\t\t\t});\r\n\t\t\tlines_g.exit().remove();\r\n\r\n\t\t\tlines = lines_g.selectAll('path.line')\r\n\t\t\t\t.data(function(d){ return d.value.filter(function(_d){ return _d.PlaceID_End; }); });\r\n\t\t\tlines.enter().append('path')\r\n\t\t\t\t.classed('line',true);\r\n\t\t\tlines\r\n\t\t\t\t.attr('d',function(d){\r\n\t\t\t\t\tvar source = {},\r\n\t\t\t\t\t\t\ttarget = {};\r\n\t\t\t\t\tvar p_1 = d.PlaceID || d.PlaceID_End,\r\n\t\t\t\t\t\t\tp_2 = d.PlaceID_End || d.PlaceID;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t//isolate x and y start coordinates using projection\r\n\t\t\t\t\tsource = projection([\r\n\t\t\t\t\t\tself.places[p_1].Long,\r\n\t\t\t\t\t\tself.places[p_1].Lat\r\n\t\t\t\t\t]);\r\n\t\t\t\t\t// if(!self.places[p_2]){debugger;}\r\n\t\t\t\t\t//isolate x and y end coordinates using projection\r\n\t\t\t\t\ttarget = projection([\r\n\t\t\t\t\t\tself.places[p_2].Long,\r\n\t\t\t\t\t\tself.places[p_2].Lat\r\n\t\t\t\t\t]);\r\n\t\t\t\t\t\r\n\t\t\t\t\t//this is a path builder -- creates a curved line between points\r\n\t\t\t\t\t//src: http://stackoverflow.com/questions/13455510/curved-line-on-d3-force-directed-tree\r\n\t\t\t\t\tvar dx = target[0] -source[0],\r\n\t\t\t\t\t\t\tdy = target[1] -source[1],\r\n\t\t\t\t\t\t\tdr = Math.sqrt((dx +d.tier) * (dx +d.tier) + (dy +d.tier) * (dy +d.tier));\r\n\t\t\t\t\treturn 'M' + source[0] + ',' + source[1] + 'A' + dr + ',' + dr + ' 0 0,1 ' + target[0] + ',' + target[1];\r\n\t\t\t\t});\r\n\t\t\tlines.exit().remove();\r\n\t\t}\r\n\r\n\t\tfunction generate_points(){\r\n  \t\t  \t\t  \t\t\r\n\t\t\t//scale for radii\r\n\t\t\tvar r_scale = d3.scale.linear()\r\n\t\t\t\t.domain([0,10])\r\n\t\t\t\t.range([0,36]);\r\n\t\t\t\t\r\n\t\t\tpoints_target = self.trajectories.map.selectAll('g.points_target')\r\n\t\t\t\t.data([self]);\r\n\t\t\tpoints_target.enter().append('g')\r\n\t\t\t\t.classed('points_target',true);\r\n\t\t\tpoints_target.exit().remove();\r\n\r\n\t\t\tpoints_g = self.trajectories.map.selectAll('g.points_g')\r\n\t\t\t\t.data(d3.entries(intersections));\r\n\t\t\tpoints_g.enter().append('g')\r\n\t\t\t\t.classed('points_g',true);\r\n\t\t\tpoints_g\r\n\t\t\t\t.attr('transform',function(d){\r\n\t\t\t\t\tvar p  = projection([\r\n\t\t\t\t\t\t\t\tself.places[d.key].Long,\r\n\t\t\t\t\t\t\t\tself.places[d.key].Lat\r\n\t\t\t\t\t\t\t]),\r\n\t\t\t\t\t\t\tpx = p[0],\r\n\t\t\t\t\t\t\tpy = p[1];\r\n\t\t\t\t\treturn 'translate(' +px +',' +py +')';\r\n\t\t\t\t})\r\n\t\t\t\t.append('title')\r\n\t\t\t\t.text(function(d){\r\n  \t\t\t\tvar tooltip = [];\r\n  \t\t\t\ttooltip.push(self.places[d.key].PlaceName);\r\n  \t\t\t\t\r\n  \t\t\t\t// Add names and citations\r\n  \t\t\t\tfor(var i=0;i< d.value.info.length;i++) {\r\n    \t\t\t\tvar info = []\r\n    \t\t\t\tinfo.push(self.authors[d.value.info[i].AuthorID]);\r\n    \t\t\t\t\r\n    \t\t\t\tif (d.value.info[i].StartDate != \"\") {\r\n      \t\t\t\tinfo.push(\" \\nFrom: \" + d.value.info[i].StartDate.toString());\r\n    \t\t\t\t}\r\n    \t\t\t\t\r\n            if(d.value.info[i].StartCitation != \"\") {\r\n              info.push(\" (\" + d.value.info[i].StartCitation.toString() + \")\")            \r\n            }    \t\t\t\t\r\n    \t\t\t\tif (d.value.info[i].EndDate != '') {\r\n      \t\t\t\tinfo.push(\"\\nUntil: \" + d.value.info[i].EndDate);\r\n    \t\t\t\t}\r\n    \t\t\t\t\r\n    \t\t\t\tif (d.value.info[i].EndDate != '') {\r\n              info.push(\" (\" + d.value.info[i].StartCitation.toString() + \")\");\r\n    \t\t\t\t}\r\n    \t\t\t\t\r\n    \t\t\t\tinfo.push(\"\\n\");\r\n    \t\t\t\ttooltip.push(info.join(''));\r\n  \t\t\t\t}\r\n  \t\t\t\t\r\n  \t\t\t\treturn tooltip.join(\"\\n\");\r\n\t\t\t\t});\r\n\t\t\tpoints_g\r\n\t\t\t\t.on('mousemove',function(d){\r\n\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t.duration(self.ttime)\r\n\t\t\t\t\t\t.attr('transform',function(_d){\r\n\t\t\t\t\t\t\tvar p  = projection([\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\r\n\t\t\t\t\t\t\t\t\t]),\r\n\t\t\t\t\t\t\t\t\tpx = p[0],\r\n\t\t\t\t\t\t\t\t\tpy = p[1];\r\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1.5)';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.on('mouseout',function(d){\r\n\t\t\t\t\td3.select(this)\r\n\t\t\t\t\t\t.transition()\r\n\t\t\t\t\t\t.duration(self.ttime/2)\r\n\t\t\t\t\t\t.attr('transform',function(_d){\r\n\t\t\t\t\t\t\tvar p  = projection([\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Long,\r\n\t\t\t\t\t\t\t\t\t\tself.places[_d.key].Lat\r\n\t\t\t\t\t\t\t\t\t]),\r\n\t\t\t\t\t\t\t\t\tpx = p[0],\r\n\t\t\t\t\t\t\t\t\tpy = p[1];\r\n\t\t\t\t\t\t\treturn 'translate(' +px +',' +py +')scale(1)';\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.on('click',function(d){\r\n\t\t\t\t\td3.event.stopPropagation();\r\n\t\t\t\t\tunfocus();\r\n\t\t\t\t\tif(d.key !== focus.key){\r\n\t\t\t\t\t\tfocus = d;\r\n\t\t\t\t\t\td3.select(this).classed('focus_point',true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgenerate_sidebar();\r\n\t\t\t\t});\r\n\t\t\tpoints_g.exit().remove();\r\n\r\n\t\t\t//circlebacks (most certain size)\r\n\t\t\tpoints_backs = points_g.selectAll('circle.point_back')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\r\n\t\t\tpoints_backs.enter().append('circle')\r\n\t\t\t\t.classed('point_back',true);\r\n\t\t\tpoints_backs\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\treturn r_scale(1);\r\n\t\t\t\t});\r\n\t\t\tpoints_backs.exit().remove();\r\n\r\n\t\t\t//least certain\r\n\t\t\tpoints_01 = points_g.selectAll('circle.point_01')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._01]; });\r\n\t\t\tpoints_01.enter().append('circle')\r\n\t\t\t\t.classed('point_01',true);\r\n\t\t\tpoints_01\r\n\t\t\t\t.classed('point',true)\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\treturn r_scale(1);\r\n\t\t\t\t});\r\n\t\t\tpoints_01.exit().remove();\r\n\t\t\t\t\r\n\t\t\t//certain\r\n\t\t\tpoints_02 = points_g.selectAll('circle.point_02')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._02]; });\r\n\t\t\tpoints_02.enter().append('circle')\r\n\t\t\t\t.classed('point_02',true);\r\n\t\t\tpoints_02\r\n\t\t\t\t.classed('point',true)\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){ \r\n\t\t\t\t\treturn r_scale(1);\r\n\t\t\t\t});\r\n\t\t\tpoints_02.exit().remove();\r\n\t\t\t\t\r\n\t\t\t//most certain\r\n\t\t\tpoints_03 = points_g.selectAll('circle.point_03')\r\n\t\t\t\t.data(function(d){ return [d.value.lists._03]; });\r\n\t\t\tpoints_03.enter().append('circle')\r\n\t\t\t\t.classed('point_03',true);\r\n\t\t\tpoints_03\r\n\t\t\t\t.classed('point',true)\r\n\t\t\t\t.attr('cx',0)\r\n\t\t\t\t.attr('cy',0)\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar r_tot = d.length;\r\n\t\t\t\t\treturn r_scale(r_tot);\r\n\t\t\t\t});\r\n\t\t\tpoints_03.exit().remove();\r\n\t\t}\r\n\r\n\t\tfunction generate_sidebar(){\r\n\t\t\tvar o_scale = d3.scale.linear()\r\n\t\t\t\t.domain([0,3])\r\n\t\t\t\t.range([0.5,1]);\r\n\r\n\t\t\tif(focus){\r\n\t\t\t\td3.select(ui.dom.intersections.results.title).html(self.places[focus.key].PlaceName);\r\n\r\n\t\t\t\t//var data = sidebar_mode === 1 ? (intersections_unique[focus.key] || []) : (trajectories_unique[focus.key]);\r\n\t\t\t\tvar data = (intersections_unique[focus.key] || []);\r\n\t\t\t\tvar items_target = d3.select(ui.dom.intersections.results.view);\r\n\t\t\t\tvar items,\r\n\t\t\t\t\t\titems_date;\r\n\r\n\t\t\t\titems = items_target.selectAll('.item')\r\n\t\t\t\t\t.data(data);\r\n\t\t\t\titems.enter().append('div')\r\n\t\t\t\t\t.classed('item',true);\r\n\t\t\t\titems\r\n\t\t\t\t\t.attr('class',function(d){\r\n\t\t\t\t\t\tvar idx = d3.keys(self.authors).indexOf(d.AuthorID);\r\n\t\t\t\t\t\treturn 'item id_' +idx;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.style('opacity',function(d){\r\n\t\t\t\t\t\treturn o_scale(d.Likelihood);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.html(function(d){\r\n\t\t\t\t\t\treturn self.authors[d.AuthorID];\r\n\t\t\t\t\t});\r\n\t\t\t\titems.exit().remove();\r\n\r\n\t\t\t\titems_date = items.selectAll('div.item_date')\r\n\t\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\t\titems_date.enter().append('div')\r\n\t\t\t\t\t.classed('item_date',true);\r\n\t\t\t\titems_date\r\n\t\t\t\t\t.html(function(d){\r\n\t\t\t\t\t\tvar str;\r\n\t\t\t\t\t\tstr = d.StartDate && d.EndDate ? d.StartDate +'&nbsp;&ndash;&nbsp;' +d.EndDate : d.StartDate ? d.StartDate +'&nbsp;&ndash;' : d.EndDate ? '&nbsp;&ndash;' +d.EndDate : '';\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t/* // Trajectory code\r\n\t\t\t\t\t\t\tvar a1 = d.PlaceID === focus.key ? 'accent' : '',\r\n\t\t\t\t\t\t\t\t\ta2 = d.PlaceID_End && d.PlaceID_End === focus.key ? 'accent' : '';\r\n\t\t\t\t\t\t\tvar p1 = '<span class=\"_' +d.Likelihood +' ' +a1 +'\">' +self.places[d.PlaceID].PlaceName +'</span>',\r\n\t\t\t\t\t\t\t\t\tp2 = '<span class=\"_' +d.Likelihood_End +' ' +a2 +'\">' +(d.PlaceID_End ? self.places[d.PlaceID_End].PlaceName : '') +'</span>';\r\n\t\t\t\t\t\t\tstr = '<div class=\"b\">' +(d.EndDate || '') +'</div><div>' +p1 +'&nbsp;&rarr;&nbsp;' +p2 +'</div>';\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\treturn str;\r\n\t\t\t\t\t});\r\n\t\t\t\titems_date.exit().remove();\r\n\r\n\t\t\t} else{\r\n\t\t\t\td3.select('#sidebar_title').html('');\r\n\t\t\t\td3.select('#sidebar_items').html('');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction update_datebar(){\r\n\t\t\tvar f = d3.time.format('%b. %Y');\r\n\t\t\td3.select('#date_start').html(f(self.date_start));\r\n\t\t\td3.select('#date_end').html(f(self.date_end));\r\n\t\t}\r\n\r\n\t\tfunction update(){\r\n\t\t\tfilter_data();\r\n\t\t\tgenerate_lines();\r\n\t\t\tgenerate_points();\r\n\t\t\tgenerate_sidebar();\r\n\t\t}\r\n\r\n\t\tfunction unfocus(){\r\n\t\t\tfocus = false;\r\n\t\t\td3.selectAll('.focus_point').classed('focus_point',false);\r\n\t\t}\r\n\r\n\t\tfilter_data();\r\n\t\tgenerate_lines();\r\n\t\tgenerate_points();\r\n\t\tgenerate_sidebar();\r\n\t}\r\n\r\n  route_change(_side){\r\n      var author_name = d3.select('#'+_side+'_select').property('value');\r\n      var author_id = this.author_names[author_name];\r\n\r\n      var curr_svg;\r\n      if(_side == 'left'){ curr_svg = this.left_svg; }\r\n      else { curr_svg = this.right_svg; }\r\n\r\n      var self = this;\r\n      var visH = this.height*30;\r\n      curr_svg.attr('height', visH);\r\n\r\n      // Find the earliest and latest itinerary dates\r\n      var starts = [], ends = [];\r\n      d3.keys(self.itineraries).forEach(\r\n          function(d){\r\n              starts.push(d3.min(self.itineraries[d], function(_d){ return (new Date(_d.StartDate)); }));\r\n              ends.push(d3.max(self.itineraries[d], function(_d){ return (new Date(_d.EndDate)); }));\r\n      });\r\n\r\n      var earliest_date = d3.min(starts);\r\n      var latest_date = d3.max(ends);\r\n\r\n      //Translate days to distance\r\n      var route_scale = d3.time.scale().domain([earliest_date, latest_date]).range([0, visH -150 -60]);\r\n\r\n      //Create route container\r\n      var route_g = curr_svg.selectAll('g.route_g').data(author_id);\r\n      route_g.enter().append('g').classed('route_g',true);\r\n      route_g\r\n          .attr('class', 'route_g author_' + _side)\r\n          .attr('transform', function(d,i){\r\n              var x = i*(self.width/2),\r\n                  y = 75;\r\n              return 'translate(' + x +',' + y +')';\r\n          });\r\n      route_g.exit().remove();\r\n\r\n      //Add background line\r\n      var route_line_background = route_g.selectAll('line.route_line_background')\r\n          .data(self.itineraries[author_id]);\r\n      route_line_background.enter().append('line').classed('route_line_background',true);\r\n      route_line_background\r\n          .attr('x1',self.width/4)\r\n          .attr('y1',function(d,i){ return route_scale(route_scale.domain()[0]); })\r\n          .attr('x2',self.width/4)\r\n          .attr('y2',function(d,i){ return route_scale(route_scale.domain()[1]); });\r\n      route_line_background.exit().remove();\r\n\r\n      //Add figure name\r\n      var route_labels = route_g.selectAll('text.route_label').data(author_id);\r\n      route_labels.enter().append('text').classed('route_label',true);\r\n      route_labels\r\n          .attr('x',self.width/4)\r\n          .attr('y',-30)\r\n          .text(author_name);\r\n      route_labels.exit().remove();\r\n\r\n      //Lines\r\n      var route_line = route_g.selectAll('line.route_line').data(self.itineraries[author_id]);\r\n      route_line.enter().append('line').classed('route_line',true);\r\n      route_line\r\n          .attr('class', 'route_line author_' + _side)\r\n          .attr('x1',self.width/4)\r\n          .attr('y1',function(d, i){\r\n              return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\r\n          })\r\n          .attr('x2',self.width/4)\r\n          .attr('y2',function(d, i){\r\n              return d.EndDate ? route_scale(new Date(d.EndDate)) : route_scale(new Date(d.StartDate));\r\n          });\r\n      route_line.exit().remove();\r\n\r\n      //Points\r\n      var route_points = route_g.selectAll('line.route_points').data(self.itineraries[author_id]);\r\n      route_points.enter().append('line').classed('route_points',true);\r\n      route_points\r\n          .attr('x1',self.width/4 -15)\r\n          .attr('y1',function(d,i){\r\n              return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\r\n          })\r\n          .attr('x2',self.width/4 +45)\r\n          .attr('y2',function(d,i){\r\n              return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\r\n          });\r\n      route_points.exit().remove();\r\n\r\n      //Stops\r\n      var route_rad = 3;\r\n      var route_stops = route_g.selectAll('circle.route_stops').data(self.itineraries[author_id]);\r\n      route_stops.enter().append('circle').classed('route_stops',true);\r\n      route_stops\r\n          .attr('cx',self.width/4 +45)\r\n          .attr('cy',function(d,i){\r\n              return d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate));\r\n          })\r\n          .attr('r',route_rad);\r\n      route_stops.exit().remove();\r\n\r\n      //Point labels\r\n      var route_point_labels = route_g.selectAll('text.route_point_labels').data(self.itineraries[author_id]);\r\n      route_point_labels.enter().append('text').classed('route_point_labels',true);\r\n      route_point_labels\r\n          .attr('x',self.width/4 +60)\r\n          .attr('y',function(d,i){\r\n              return (d.StartDate ? route_scale(new Date(d.StartDate)) : route_scale(new Date(d.EndDate))) +4;\r\n          })\r\n          .text(function(d){\r\n              var t1 = d.StartDate || 'Unknown',\r\n                  t2 = d.EndDate || 'Unknown';\r\n              return self.places[d.PlaceID].PlaceName + ' (' +t1 +' to ' +t2 +')';\r\n          });\r\n      route_point_labels.exit().remove();\r\n\r\n  }\r\n\r\n  generate_routes(){\r\n      var visH = this.height*6;\r\n      this.svg.attr('height', visH);\r\n  }\r\n\r\n\tswitch_mode(_id){\r\n\t\tthis.mode = _id;\r\n\t\tthis.tear_down();\r\n\t\t\t\t\t\t\r\n    switch(this.mode) {\r\n      case '1':\r\n      default:\r\n        this.generate_int_map();\r\n        break;\r\n      case '2':\r\n        this.generate_traj_map();\r\n        break;\r\n      case '3':\r\n        this.generate_routes();\r\n    }\r\n\t}\r\n\r\n\ttear_down(){\r\n\t\tvar opp = this.mode === 1 ? 2 : 1;\r\n\t\t\r\n\t\tthis.intersections.map.selectAll(\"*\").remove();\r\n\t\td3.select(ui.dom.intersections.dateslider).selectAll('*').remove();\r\n\t\td3.select(ui.dom.trajectories.dateslider).selectAll('*').remove();\r\n\t\t\r\n\t\td3.selectAll('.sidebar_tab.selected').classed('selected',false);\r\n\t\td3.select('.sidebar_tab#sidebar_01').classed('selected',true);\r\n\r\n\t\td3.selectAll('._0' +opp).style('display','none');\r\n\t\td3.selectAll('._0' +this.mode).style('display','block');\r\n\r\n\t\tthis.date_start = this.range[0];\r\n\t\tthis.date_end = this.range[1];\r\n\t}\r\n}\r\n\r\nvar vis = new CreateMap();\r\nvis.get_data();\r\n\r\n//custom sub-selections\r\nd3.selection.prototype.first = function() {\r\n  return d3.select(this[0][0]);\r\n};\r\nd3.selection.prototype.last = function() {\r\n  var last = this.size() - 1;\r\n  return d3.select(this[0][last]);\r\n};\r\n\r\n\r\n// old_routes(){\r\n\r\n// }\r\n"]}