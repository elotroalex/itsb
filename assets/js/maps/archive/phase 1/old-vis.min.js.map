{"version":3,"sources":["archive/phase 1/old-vis.js"],"names":["init","loading","width","window","innerWidth","height","innerHeight","data","date","start","Date","end","focus","place","navigation","navActive","projection","path","intersections","intersections_journeys","trajectories","visible_authors","dt_from","dt_to","dt_cur_from","dt_cur_to","sidebar_mode","loadingManager","_elem","_callback","self","vis","filter","d","length","getData","datasets","callback","forEach","push","filepath","d3","json","e","_d","generateDateSlider","months","$","html","min_val","parse","max_val","formatDT","__dt","year","getFullYear","getMonth","slider","range","min","max","step","values","slide","ui","update","generate","svg","select","append","attr","on","selectAll","classed","geo","mercator","scale","translate","map","features","topojson","feature","continents","objects","enter","exit","remove","generate_lines","generate_points","generate_legend","updateSidebar","filterData","trajectoriesG","selector_A","ArCiCo","replace","selector_D","DptCiCo","selected","AuthorID","source","target","raw","places","x","y","dx","dy","dr","Math","sqrt","tier","isChromium","chrome","winNav","navigator","vendorName","vendor","isOpera","userAgent","indexOf","isIEedge","match","undefined","m","mouse","this","f","tt","c","pathNode","point","best","bestLength","scan","scanDistance","pathLength","getTotalLength","precision","bestDistance","Infinity","scanLength","distance2","getPointAtLength","before","after","beforeLength","afterLength","beforeDistance","afterDistance","distance","p","closestPoint","node","tt_content","text","Name","split","join","event","stopPropagation","pointG","pointBacks","points","points_YearSpec","points_MonthSpec","pointScale","linear","domain","pointData","keys","obj","placeName","loc","posX","posY","specY","specificity","specM","specD","selector","i","_scale","legend","legendLabels","legendTrajectory","legendData","merge","nav_auth","auth_div","auth_name","auth_desc","auth_input","place_city","place_country","place_string","showTrajectories","author_arr","style","str","authors","name","str_date","str_pl_1","str_pl_2","dpt","arr","dd","showAuthors","entries","property","key","checked","id","tStamp_start","getTime","tStamp_end","tStamp_currentDatum","_i","__d","__i","authorVisible","authorAccountedFor","authorFilteredList","val_map","Y","M","D","a","placePairs","placePair","processData"],"mappings":"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","file":"../../../archive/phase 1/old-vis.min.js","sourcesContent":["var init = function(){\r\n\r\n\treturn {\r\n\r\n\t\t//empty loading array to hold pending datasets\r\n\t\tloading:[],\r\n\r\n\t\t//store screen height and width\r\n\t\twidth:window.innerWidth,\r\n\t\theight:window.innerHeight,\r\n\t\t\r\n\t\tinit:true,\r\n\r\n\t\tdata:{},\r\n\t\tdate:{\r\n\t\t\tstart:new Date(),\r\n\t\t\tend:new Date()\r\n\t\t},\r\n\t\tfocus:{\r\n\t\t\tplace:\"\"\r\n\t\t},\r\n\r\n\t\tnavigation:null,\r\n\t\tnavActive:false,\r\n\r\n\t\tprojection:null,\r\n\t\tpath:null,\r\n\r\n\t\tintersections:{},\r\n\t\tintersections_journeys:{},\r\n\r\n\t\ttrajectories:[],\r\n\r\n\t\tvisible_authors:[],\r\n\r\n\t\t//date slider variables\r\n\t\tdt_from:\"1913-06-25\",\r\n        dt_to:\"2016-11-24\",\r\n        \r\n        dt_cur_from:null,\r\n        dt_cur_to:null,\r\n\r\n        sidebar_mode:'trajectories',\r\n\r\n\t\t//ensures the callback function is only called\r\n\t\t//once all datasets have been retrieved\r\n\t\tloadingManager:function(_elem,_callback){\r\n\t\t\tvar self = vis;\r\n\t\t\tvar empty = false;\r\n\r\n\t\t\t//remove name of retrieved JSON document from loading array\r\n\t\t\tself.loading = self.loading.filter(function(d){\r\n\t\t\t\treturn d !== _elem;\r\n\t\t\t});\r\n\r\n\t\t\t//if loading array is empty, callback function\r\n\t\t\tif(self.loading.length === 0){\r\n\t\t\t\t_callback();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t//retrieves datasets\r\n\t\tgetData:function(_callback){\r\n\t\t\tvar self = vis;\r\n\r\n\t\t\t//'datasets' array holds strings for all files to be retrieved\r\n\t\t\tvar datasets = ['continents','intersections','trajectories','places','authors'],\r\n\t\t\t\tcallback = _callback;\r\n\r\n\t\t\tdatasets.forEach(function(d){\r\n\r\n\t\t\t\t//push name of dataset into loading array\r\n\t\t\t\tself.loading.push(d);\r\n\t\t\t});\r\n\r\n\t\t\t//cycle through each string in the array\r\n\t\t\tdatasets.forEach(function(d){\r\n\r\n\t\t\t\t//concat filename and path from dataset name\r\n\t\t\t\tvar filepath = 'data/' +d +'.json';\r\n\r\n\t\t\t\t//retrieve dataset\r\n\t\t\t\td3.json(filepath,function(e,_d){\r\n\t\t\t\t\tif(!e){\r\n\t\t\t\t\t\tself.data[d] = _d;\r\n\t\t\t\t\t\tself.loadingManager(d,callback);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t//generates date slider\r\n\t\tgenerateDateSlider:function(){\r\n\r\n\t\t\tvar self = vis;\r\n\t\t\tvar months = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sept\", \"Oct\", \"Nov\", \"Dec\"];\r\n\r\n            $('.slider-time').html(\"Jun. 1913\"); //Should pull from \"self.dt_from\"\r\n            $('.slider-time2').html(\"Nov. 2016\");\r\n\r\n            var min_val = Date.parse(self.dt_from)/1000;\r\n            var max_val = Date.parse(self.dt_to)/1000;\r\n\r\n            function formatDT(__dt) {\r\n                var year = __dt.getFullYear();\r\n                var month = months[__dt.getMonth()];\r\n                //var date = zeroPad(__dt.getDate(), 2);\r\n                \r\n                return month + '. ' + year;\r\n            };\r\n\r\n            $(\"#slider-range\").slider({\r\n                range:true,\r\n                min:min_val,\r\n                max:max_val,\r\n                step:10,\r\n                values:[min_val, max_val],\r\n                slide:function (e, ui) {\r\n                    self.dt_cur_from = new Date(ui.values[0]*1000); //.format(\"yyyy-mm-dd hh:ii:ss\");\r\n                    $('.slider-time').html(formatDT(self.dt_cur_from));\r\n\r\n                    self.dt_cur_to = new Date(ui.values[1]*1000); //.format(\"yyyy-mm-dd hh:ii:ss\");                \r\n                    $('.slider-time2').html(formatDT(self.dt_cur_to));\r\n\r\n                    self.update();\r\n                }\r\n            });\r\n\t\t},\r\n\r\n\t\t//generates visualization\r\n\t\tgenerate:function(){\r\n\t\t\tvar self = vis;\r\n\r\n\t\t\tself.svg = d3.select('#container').append('svg')\r\n\t\t\t\t.attr('width',self.width)\r\n\t\t\t\t.attr('height',self.height)\r\n\t\t\t\t.on('click',function(){\r\n\t\t\t\t\tself.focus.place = null;\r\n\r\n\t\t\t\t\tself.update();\r\n\r\n\t\t\t\t\t//d3.select('#nav_place span').text('');\r\n\t\t\t\t\t//d3.select('#nav_auth').html('');\r\n\t\t\t\t\td3.selectAll('.selected').classed('selected',false);\r\n\t\t\t\t});\r\n\r\n\t\t\tif(!self.focus.place || self.focus.place === null){\r\n\t\t\t\tself.focus.place = \"Paris_France\";\r\n\t\t\t}\r\n\r\n\t\t\tself.projection = d3.geo.mercator()\r\n\t\t\t\t.scale(220)\r\n\t\t\t\t.translate([self.width*0.36,self.height*0.6])\r\n\t\t\t\t;\r\n\r\n\t\t\tself.path = d3.geo.path()\r\n\t\t\t\t.projection(self.projection);\r\n\r\n\t\t\t//var features = topojson.feature(self.data.countries,self.data.countries.objects.countries);\r\n\t\t\tvar features = topojson.feature(self.data.continents,self.data.continents.objects.continents);\r\n\r\n\t\t\t//draw vector map\r\n\t\t\tvar map;\r\n\t\t\tmap = self.svg.selectAll('path.map')\r\n\t\t\t\t.data([features]);\r\n\t\t\tmap.enter().append('path')\r\n\t\t\t\t.classed('map',true);\r\n\t\t\tmap\r\n\t\t\t\t.attr('d',self.path)\r\n\t\t\t\t//.attr('filter','url(#f1)')\r\n\t\t\t\t;\r\n\t\t\tmap.exit().remove();\r\n\r\n\t\t\tself.generate_lines();\r\n\t\t\tself.generate_points(self.generate_legend);\r\n\r\n\t\t\tself.updateSidebar();\r\n\t\t},\r\n\r\n\t\tupdate:function(){\r\n\t\t\tvar self = vis;\r\n\r\n\t\t\tself.filterData();\r\n\t\t\tself.generate_lines();\r\n\t\t\tself.generate_points();\r\n\t\t\tself.updateSidebar();\r\n\t\t},\r\n\r\n\t\tgenerate_lines:function(){\r\n\t\t\tvar self = vis;\r\n\r\n\t\t\t//thank you, https://bl.ocks.org/mbostock/8027637\r\n\t\t\tfunction closestPoint(pathNode, point) {\r\n\t\t\t  var pathLength = pathNode.getTotalLength(),\r\n\t\t\t      precision = 8,\r\n\t\t\t      best,\r\n\t\t\t      bestLength,\r\n\t\t\t      bestDistance = Infinity;\r\n\r\n\t\t\t  // linear scan for coarse approximation\r\n\t\t\t  for (var scan, scanLength = 0, scanDistance; scanLength <= pathLength; scanLength += precision) {\r\n\t\t\t    if ((scanDistance = distance2(scan = pathNode.getPointAtLength(scanLength))) < bestDistance) {\r\n\t\t\t      best = scan, bestLength = scanLength, bestDistance = scanDistance;\r\n\t\t\t    }\r\n\t\t\t  }\r\n\r\n\t\t\t  // binary search for precise estimate\r\n\t\t\t  precision /= 2;\r\n\t\t\t  while (precision > 0.5) {\r\n\t\t\t    var before,\r\n\t\t\t        after,\r\n\t\t\t        beforeLength,\r\n\t\t\t        afterLength,\r\n\t\t\t        beforeDistance,\r\n\t\t\t        afterDistance;\r\n\t\t\t    if ((beforeLength = bestLength - precision) >= 0 && (beforeDistance = distance2(before = pathNode.getPointAtLength(beforeLength))) < bestDistance) {\r\n\t\t\t      best = before, bestLength = beforeLength, bestDistance = beforeDistance;\r\n\t\t\t    } else if ((afterLength = bestLength + precision) <= pathLength && (afterDistance = distance2(after = pathNode.getPointAtLength(afterLength))) < bestDistance) {\r\n\t\t\t      best = after, bestLength = afterLength, bestDistance = afterDistance;\r\n\t\t\t    } else {\r\n\t\t\t      precision /= 2;\r\n\t\t\t    }\r\n\t\t\t  }\r\n\r\n\t\t\t  best = [best.x, best.y];\r\n\t\t\t  best.distance = Math.sqrt(bestDistance);\r\n\t\t\t  return best;\r\n\r\n\t\t\t  function distance2(p) {\r\n\t\t\t    var dx = p.x - point[0],\r\n\t\t\t        dy = p.y - point[1];\r\n\t\t\t    return dx * dx + dy * dy;\r\n\t\t\t  }\r\n\t\t\t}\r\n\r\n\t\t\t//plot lines\r\n\t\t\tvar trajectoriesG,\r\n\t\t\t\ttrajectories;\r\n\t\t\ttrajectoriesG = self.svg.selectAll('g.trajectoriesG')\r\n\t\t\t\t.data([self.trajectories]);\r\n\t\t\ttrajectoriesG.enter().append('g')\r\n\t\t\t\t.classed('trajectoriesG',true);\r\n\t\t\ttrajectoriesG.exit().remove();\r\n\t\t\ttrajectories = trajectoriesG.selectAll('path.trajectory')\r\n\t\t\t\t.data(function(d){ return d; });\r\n\t\t\ttrajectories.enter().append('path')\r\n\t\t\t\t.classed('trajectory',true);\r\n\t\t\ttrajectories\r\n\t\t\t\t.attr('class',function(d){\r\n\t\t\t\t\tvar selector_A = d.ArCiCo.replace(/ /g, ''),\r\n\t\t\t\t\t\tselector_D = d.DptCiCo.replace(/ /g, '')\r\n\t\t\t\t\t\tselected = (d.ArCiCo === self.focus.place || d.DptCiCo === self.focus.place) ? 'selected' : '';\r\n\t\t\t\t\treturn 'trajectory ' +selector_A +' ' +selector_D +' ' +d.AuthorID +' ' +selected;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('d',function(d){\r\n\r\n\t\t\t\t\tvar source = {},\r\n\t\t\t\t\t\ttarget = {};\r\n\r\n\t\t\t\t\t//isolate x and y start coordinates using projection\r\n\t\t\t\t\tsource.raw = self.projection([\r\n\t\t\t\t\t\tself.data.places[d.ArCiCo][1],\r\n\t\t\t\t\t\tself.data.places[d.ArCiCo][0]\r\n\t\t\t\t\t]);\r\n\t\t\t\t\tsource.x = source.raw[0];\r\n\t\t\t\t\tsource.y = source.raw[1];\r\n\r\n\t\t\t\t\t//isolate x and y end coordinates using projection\r\n\t\t\t\t\ttarget.raw = self.projection([\r\n\t\t\t\t\t\tself.data.places[d.DptCiCo][1],\r\n\t\t\t\t\t\tself.data.places[d.DptCiCo][0]\r\n\t\t\t\t\t]);\r\n\t\t\t\t\ttarget.x = target.raw[0];\r\n\t\t\t\t\ttarget.y = target.raw[1];\r\n\r\n\t\t\t\t\t//this is a path builder -- creates a curved line between points\r\n\t\t\t\t\t//src: http://stackoverflow.com/questions/13455510/curved-line-on-d3-force-directed-tree\r\n\t\t\t\t\tvar dx = target.x -source.x,\r\n\t\t\t\t\t\tdy = target.y -source.y,\r\n\t\t\t\t\t\tdr = Math.sqrt((dx +d.tier) * (dx +d.tier) + (dy +d.tier) * (dy +d.tier));\r\n\t\t\t\t\treturn 'M' + source.x + ',' + source.y + 'A' + dr + ',' + dr + ' 0 0,1 ' + target.x + ',' + target.y;\r\n\t\t\t\t});\r\n\t\t\ttrajectories.exit().remove();\r\n\r\n\t\t\t//check of Google Chrome\r\n\t\t\t// please note, \r\n\t\t\t// that IE11 now returns undefined again for window.chrome\r\n\t\t\t// and new Opera 30 outputs true for window.chrome\r\n\t\t\t// and new IE Edge outputs to true now for window.chrome\r\n\t\t\t// and if not iOS Chrome check\r\n\t\t\t// so use the below updated condition\r\n\t\t\tvar isChromium = window.chrome,\r\n\t\t\t    winNav = window.navigator,\r\n\t\t\t    vendorName = winNav.vendor,\r\n\t\t\t    isOpera = winNav.userAgent.indexOf(\"OPR\") > -1,\r\n\t\t\t    isIEedge = winNav.userAgent.indexOf(\"Edge\") > -1,\r\n\t\t\t    isIOSChrome = winNav.userAgent.match(\"CriOS\");\r\n\r\n\t\t\t//if(isIOSChrome){\r\n\t\t\t   // is Google Chrome on IOS\r\n\t\t\t//} else if(isChromium !== null && isChromium !== undefined && vendorName === \"Google Inc.\" && isOpera == false && isIEedge == false) {\r\n\t\t\t   // is Google Chrome\r\n\t\t\t//} else { \r\n\t\t\t   // not Google Chrome \r\n\t\t\t//}\r\n\r\n\t\t\t//this is slow in any other browser but Chrome -- refactor in beta\r\n\t\t\tif(isChromium !== null && isChromium !== undefined && vendorName === \"Google Inc.\" && isOpera == false && isIEedge == false) {\r\n\t\t\t\t//interaction handler for trajectories\r\n\t\t\t\tself.svg\r\n\t\t\t\t\t.on('mousemove',function(e){\r\n\t\t\t\t\t\tvar m = d3.mouse(this),\r\n\t\t\t\t\t\t\tf = null,\r\n\t\t\t\t\t\t\ttt = false;\r\n\r\n\t\t\t\t\t\t//determine which path to focus on\r\n\t\t\t\t\t\ttrajectories.classed('hov',function(d){\r\n\t\t\t\t\t\t\t\tvar p = closestPoint(d3.select(this).node(),m),\r\n\t\t\t\t\t\t\t\t\tt = p.distance <2,\r\n\t\t\t\t\t\t\t\t\tc = false;\r\n\t\t\t\t\t\t\t\tif(t){\r\n\t\t\t\t\t\t\t\t\tc = !tt;\r\n\t\t\t\t\t\t\t\t\tf = d;\r\n\t\t\t\t\t\t\t\t\ttt = true;\r\n\r\n\t\t\t\t\t\t\t\t\tif(self.tt){\r\n\t\t\t\t\t\t\t\t\t\tself.tt.attr('transform',function(){\r\n\t\t\t\t\t\t\t\t\t\t\t\tvar x = m[0],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ty = m[1],\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpad_x = 0,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tpad_y = -10;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\tx +=pad_x;\r\n\t\t\t\t\t\t\t\t\t\t\t\ty +=pad_y;\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\treturn 'translate(' +x +',' +y +')';\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tself.tt_content.text(d.Name + ': ' +d.DptCiCo.split('_').join(', ') +' → ' +d.ArCiCo.split('_').join(', '));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn c;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(self.tt){ \r\n\t\t\t\t\t\t\tself.tt.attr('class',function(d){\r\n\t\t\t\t\t\t\t\tvar v = tt ? 'visible' : '',\r\n\t\t\t\t\t\t\t\t\ta = f ? f.AuthorID : '';\r\n\t\t\t\t\t\t\t\treturn v +' tt ' +a;\r\n\t\t\t\t\t\t\t}); \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\td3.event.stopPropagation();\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgenerate_points:function(_callback){\r\n\t\t\tvar self = vis;\r\n\r\n\t\t\t//define min and max radii\r\n\t\t\t//define point scale\r\n\t\t\tvar minR = 0.5,\r\n\t\t\t\tmaxR = 15;\r\n\t\t\tvar pointScale = d3.scale.linear()\r\n\t\t\t\t.domain([0,10])\t//min and max of final data\r\n\t\t\t\t.range([minR,maxR]);\r\n\r\n\t\t\t//define all variables needed for plotting points\r\n\t\t\tvar pointG,\r\n\r\n\t\t\t\tpointBacks,\r\n\t\t\t\tpoints,\r\n\r\n\t\t\t\tpoints_YearSpec,\r\n\t\t\t\tpoints_MonthSpec,\r\n\r\n\t\t\t\tpointData = [];\r\n\r\n\t\t\t//store x/y coordinates for each, so we don't have to recalculate these every time\r\n\t\t\td3.keys(self.intersections).forEach(function(d){\r\n\t\t\t\tvar obj = {};\r\n\r\n\t\t\t\tobj.placeName = d;\r\n\r\n\t\t\t\t//pass coordinates into projection\r\n\t\t\t\t//returns an array of screen coordinates\r\n\t\t\t\tvar loc = self.projection([\r\n\t\t\t\t\tself.data.places[obj.placeName][1],\r\n\t\t\t\t\tself.data.places[obj.placeName][0]\r\n\t\t\t\t]);\r\n\t\t\t\tobj.posX = loc[0];\r\n\t\t\t\tobj.posY = loc[1];\r\n\r\n\t\t\t\t//get specificity\r\n\t\t\t\tobj.specY = self.intersections[d].filter(function(_d){ return _d.specificity === \"Y\"; }).length;\r\n\t\t\t\tobj.specM = self.intersections[d].filter(function(_d){ return _d.specificity === \"M\"; }).length;\r\n\t\t\t\tobj.specD = self.intersections[d].filter(function(_d){ return _d.specificity === \"D\"; }).length;\r\n\r\n\t\t\t\tpointData.push(obj);\r\n\t\t\t});\r\n\r\n\t\t\t//point holder\r\n\t\t\tpointG = self.svg.selectAll('g.pointG')\r\n\t\t\t\t.data(pointData);\r\n\t\t\tpointG.enter().append('g')\r\n\t\t\t\t.classed('pointG',true);\r\n\t\t\tpointG\r\n\t\t\t\t.attr('class',function(d){\r\n\t\t\t\t\tvar selector = d.placeName.replace(/ /g, ''),\r\n\t\t\t\t\t\tselected = d.placeName === self.focus.place ? 'selected' : '';\r\n\t\t\t\t\treturn 'pointG ' +selector +' ' +selected;\r\n\t\t\t\t});\r\n\t\t\tpointG\r\n\t\t\t\t.on('mouseover',function(d){\r\n\t\t\t\t\tvar selector = d.placeName.replace(/ /g, '');\r\n\t\t\t\t\td3.selectAll('.hov').classed('hov',false);\r\n\t\t\t\t\td3.selectAll('.' +selector).classed('hov',true);\r\n\t\t\t\t\td3.event.stopPropagation();\r\n\t\t\t\t})\r\n\t\t\t\t.on('mouseout',function(d){\r\n\t\t\t\t\td3.selectAll('.hov').classed('hov',false);\r\n\t\t\t\t})\r\n\t\t\t\t.on('click', function(d){\r\n\r\n\t\t\t\t\t//set focus\r\n\t\t\t\t\tself.focus.place = d.placeName;\r\n\r\n\t\t\t\t\td3.selectAll('.selected').classed('selected',false);\r\n\t\t\t\t\td3.selectAll('.' +self.focus.place).classed('selected',true);\r\n\r\n\t\t\t\t\t//update sidebar\r\n\t\t\t\t\tself.updateSidebar();\r\n\r\n\t\t\t\t\t//prevent event bubbling\r\n\t\t\t\t\td3.event.stopPropagation();\r\n\t\t\t\t});\r\n\t\t\tpointG.exit().remove();\r\n\r\n\t\t\t//plot background circles (two groups)\r\n\t\t\tpoints_YearSpec = pointG.selectAll('circle.points_YearSpec')\r\n\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\tpoints_YearSpec.enter().append('circle')\r\n\t\t\t\t.classed('points_YearSpec',true);\r\n\t\t\tpoints_YearSpec\r\n\t\t\t\t.classed('marker',true)\r\n\t\t\t\t.attr('cx',function(d,i){\r\n\t\t\t\t\treturn d.posX;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('cy',function(d){\r\n\t\t\t\t\treturn d.posY;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar radius = pointScale(d.specD +d.specM +d.specY);\r\n\t\t\t\t\treturn radius;\r\n\t\t\t\t});\r\n\t\t\tpoints_YearSpec.exit().remove();\r\n\t\t\tpoints_MonthSpec = pointG.selectAll('circle.points_MonthSpec')\r\n\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\tpoints_MonthSpec.enter().append('circle')\r\n\t\t\t\t.classed('points_MonthSpec',true);\r\n\t\t\tpoints_MonthSpec\r\n\t\t\t\t.classed('marker',true)\r\n\t\t\t\t.attr('cx',function(d,i){\r\n\t\t\t\t\treturn d.posX;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('cy',function(d){\r\n\t\t\t\t\treturn d.posY;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar radius = pointScale(d.specD +d.specM);\r\n\t\t\t\t\treturn radius;\r\n\t\t\t\t});\r\n\t\t\tpoints_MonthSpec.exit().remove();\r\n\t\t\t\r\n\t\t\t//plot pointbacks\r\n\t\t\tpointBacks = pointG.selectAll('circle.pointBack')\r\n\t\t\t\t.data(function(d){ return [d]; })\r\n\t\t\t\t;\r\n\t\t\tpointBacks.enter().append('circle')\r\n\t\t\t\t.classed('pointBack',true);\r\n\t\t\tpointBacks\r\n\t\t\t\t.classed('marker',true)\r\n\t\t\t\t.attr('cx',function(d){\r\n\t\t\t\t\treturn d.posX;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('cy',function(d){\r\n\t\t\t\t\treturn d.posY;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar radius = pointScale(d.specD);\r\n\t\t\t\t\treturn radius;\r\n\t\t\t\t});\r\n\t\t\tpointBacks.exit().remove();\r\n\r\n\t\t\t//plot points\r\n\t\t\tpoints = pointG.selectAll('circle.point')\r\n\t\t\t\t.data(function(d){ return [d]; })\r\n\t\t\t\t;\r\n\t\t\tpoints.enter().append('circle')\r\n\t\t\t\t.classed('point',true);\r\n\t\t\tpoints\r\n\t\t\t\t.classed('marker',true)\r\n\t\t\t\t.attr('cx',function(d){\r\n\t\t\t\t\treturn d.posX;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('cy',function(d){\r\n\t\t\t\t\treturn d.posY;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('r',function(d){\r\n\t\t\t\t\tvar radius = pointScale(d.specD);\r\n\t\t\t\t\treturn radius;\r\n\t\t\t\t});\r\n\t\t\tpoints.exit().remove();\r\n\r\n\t\t\t//create tooltip\r\n\t\t\tself.tt = self.svg.selectAll('g.tt')\r\n\t\t\t\t.data([self]);\r\n\t\t\tself.tt.enter().append('g')\r\n\t\t\t\t.classed('tt',true);\r\n\t\t\tself.tt\r\n\t\t\t\t.classed('visible',false);\r\n\t\t\tself.tt.exit().remove();\r\n\t\t\tself.tt_content = self.tt.selectAll('text.tt_content')\r\n\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\tself.tt_content.enter().append('text')\r\n\t\t\t\t.classed('tt_content',true);\r\n\t\t\tself.tt_content\r\n\t\t\t\t.text('');\r\n\t\t\tself.tt_content.exit().remove();\r\n\r\n\t\t\tif(_callback){\r\n\t\t\t\t_callback(pointScale);\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tgenerate_legend:function(_scale){\r\n\t\t\tvar self = vis;\r\n\t\t\tvar scale = _scale;\r\n\r\n\t\t\t//legend\r\n\t\t\tvar legend,\r\n\t\t\t\tlegendLabels,\r\n\t\t\t\tlegendTrajectory,\r\n\t\t\t\tlegendTrajectoryLabel,\r\n\r\n\t\t\t\tlegend_ySpace = 15;\r\n\t\t\tvar legendData = [\r\n\t\t\t\t\t'Specificity — Day',\r\n\t\t\t\t\t'Specificity — Month',\r\n\t\t\t\t\t'Specificity — Year',\r\n\t\t\t\t\t'1 intersection',\r\n\t\t\t\t\t'3 intersections',\r\n\t\t\t\t\t'6 intersections'\r\n\t\t\t\t];\r\n\t\t\tlegend = d3.select('#nav_legend svg').selectAll('circle.marker')\r\n\t\t\t\t.data(legendData);\r\n\t\t\tlegend.enter().append('circle')\r\n\t\t\t\t.classed('marker',true);\r\n\t\t\tlegend\r\n\t\t\t\t.attr('class',function(d,i){\r\n\t\t\t\t\tvar spec = i === 1 ? 'points_MonthSpec' : i === 2 ? 'points_YearSpec' : '';\r\n\t\t\t\t\treturn 'marker ' +spec;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('cx',function(d,i){\r\n\t\t\t\t\tvar xpos = i <3 ? 150 : 15;\r\n\t\t\t\t\treturn xpos;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('cy',function(d,i){\r\n\t\t\t\t\tvar ypos = (i%3)*legend_ySpace +15;\r\n\t\t\t\t\treturn ypos;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('r',function(d,i){\r\n\t\t\t\t\tvar rad = 0;\r\n\t\t\t\t\tif(i <3){\r\n\t\t\t\t\t\trad = scale(2);\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\trad = +d.split(' ')[0];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn rad;\r\n\t\t\t\t});\r\n\t\t\tlegend.exit().remove();\r\n\t\t\tlegendLabels = d3.select('#nav_legend svg').selectAll('text.legendLabel')\r\n\t\t\t\t.data(d3.merge([legendData,['Journey trajectory']]));\r\n\t\t\tlegendLabels.enter().append('text')\r\n\t\t\t\t.classed('legendLabel',true);\r\n\t\t\tlegendLabels\r\n\t\t\t\t.attr('x',function(d,i){\r\n\t\t\t\t\tvar xpos;\r\n\t\t\t\t\tif(i <6){\r\n\t\t\t\t\t\txpos = i <3 ? 165 : 27;\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\txpos = 165;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn xpos;\r\n\t\t\t\t})\r\n\t\t\t\t.attr('y',function(d,i){\r\n\t\t\t\t\tvar ypos;\r\n\t\t\t\t\tif(i <6){\r\n\t\t\t\t\t\typos = (i%3)*legend_ySpace +18;\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\typos = 3*legend_ySpace +18;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn ypos;\r\n\t\t\t\t})\r\n\t\t\t\t.text(function(d){\r\n\t\t\t\t\tvar str = d;\r\n\t\t\t\t\treturn str;\r\n\t\t\t\t});\r\n\t\t\tlegendLabels.exit().remove();\r\n\t\t\tlegendTrajectory = d3.select('#nav_legend svg').selectAll('path.legendTrajectory')\r\n\t\t\t\t.data([self]);\r\n\t\t\tlegendTrajectory.enter().append('path')\r\n\t\t\t\t.classed('legendTrajectory',true);\r\n\t\t\tlegendTrajectory\r\n\t\t\t\t.attr('d',function(d){\r\n\r\n\t\t\t\t\tvar source = {},\r\n\t\t\t\t\t\ttarget = {};\r\n\r\n\t\t\t\t\tsource.x = 100;\r\n\t\t\t\t\tsource.y = 60;\r\n\r\n\t\t\t\t\ttarget.x = 150;\r\n\t\t\t\t\ttarget.y = 60;\r\n\r\n\t\t\t\t\tvar f = 20;\r\n\r\n\t\t\t\t\t//this is a path builder -- creates a curved line between points\r\n\t\t\t\t\t//src: http://stackoverflow.com/questions/13455510/curved-line-on-d3-force-directed-tree\r\n\t\t\t\t\tvar dx = target.x -source.x,\r\n\t\t\t\t\t\tdy = target.y -source.y,\r\n\t\t\t\t\t\tdr = Math.sqrt((dx +f) * (dx +f) + (dy +f) * (dy +f));\r\n\t\t\t\t\treturn 'M' + source.x + ',' + source.y + 'A' + dr + ',' + dr + ' 0 0,1 ' + target.x + ',' + target.y;\r\n\t\t\t\t});\r\n\t\t\tlegendTrajectory.exit().remove();\r\n\t\t},\r\n\r\n\t\tupdateSidebar:function(){\r\n\t\t\tvar self = vis;\r\n\t\t\tvar place_city = self.focus.place ? self.focus.place.split('_')[0] : '',\r\n\t\t\t\tplace_country = self.focus.place ? self.focus.place.split('_')[1] : '',\r\n\t\t\t\tplace_string = self.focus.place ? place_city +', ' +place_country : '(All locations)';\r\n\r\n\t\t\t//update sidebar with placename\r\n\t\t\td3.select('#nav_place span')\r\n\t\t\t\t.text(place_string);\r\n\t\t\t\r\n\t\t\tvar nav_auth,\r\n\t\t\t\tauth_div,\r\n\t\t\t\tauth_name,\r\n\t\t\t\tauth_desc,\r\n\t\t\t\tauth_input;\r\n\r\n\t\t\tnav_auth = d3.select('#nav_auth')\r\n\t\t\t\t\t.style('height',function(){\r\n\t\t\t\t\t\treturn self.height -(self.width*0.03) -375 +'px';\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.style('opacity',1);\r\n\t\t\tlegend = d3.select('#nav_legend').style('opacity',1);\r\n\r\n\t\t\t//tab control\r\n\t\t\tvar tabs = d3.selectAll('#nav_tabcontrol .btn');\r\n\t\t\ttabs\r\n\t\t\t\t.classed('selected_tab',function(){\r\n\t\t\t\t\treturn this.id === self.sidebar_mode;\r\n\t\t\t\t})\r\n\t\t\t\t.on('click',function(){\r\n\t\t\t\t\td3.selectAll('#nav_tabcontrol .btn.selected_tab').classed('selected_tab',false);\r\n\t\t\t\t\td3.select(this).classed('selected_tab',true);\r\n\t\t\t\t\tself.sidebar_mode = this.id;\r\n\r\n\t\t\t\t\tif(self.sidebar_mode === 'trajectories'){\r\n\t\t\t\t\t\tshowTrajectories();\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\tshowAuthors();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tif(self.sidebar_mode === 'trajectories'){\r\n\t\t\t\tshowTrajectories();\r\n\t\t\t} else{\r\n\t\t\t\tshowAuthors();\r\n\t\t\t}\r\n\r\n\t\t\tfunction showTrajectories(){\r\n\r\n\t\t\t\t//update author list\r\n\t\t\t\t//first, get author array\r\n\t\t\t\t//next, build list of names\r\n\t\t\t\tvar author_arr = [];\r\n\t\t\t\tif(self.focus.place && self.intersections_journeys[self.focus.place]){\r\n\t\t\t\t\tauthor_arr = self.intersections_journeys[self.focus.place];\r\n\t\t\t\t} else if(self.focus.place === null){\r\n\t\t\t\t\td3.keys(self.intersections_journeys).forEach(function(d){\r\n\t\t\t\t\t\tself.intersections_journeys[d].forEach(function(_d){ \r\n\t\t\t\t\t\t\tif(author_arr.indexOf(_d) <0){\r\n\t\t\t\t\t\t\t\tauthor_arr.push(_d); \r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tauth_div = nav_auth\r\n\t\t\t\t\t.selectAll('div.auth_div')\r\n\t\t\t\t\t.data(author_arr);\r\n\t\t\t\tauth_div.enter().append('div')\r\n\t\t\t\t\t.classed('auth_div',true);\r\n\t\t\t\tauth_div.exit().remove();\r\n\t\t\t\tauth_input = auth_div\r\n\t\t\t\t\t.selectAll('input.auth_input')\r\n\t\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\t\tauth_input.enter().append('input')\r\n\t\t\t\t\t.classed('auth_input',true);\r\n\t\t\t\tauth_input\r\n\t\t\t\t\t.style('display','none');\r\n\t\t\t\tauth_input.exit().remove();\r\n\t\t\t\tauth_name = auth_div\r\n\t\t\t\t\t.selectAll('span.auth_name')\r\n\t\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\t\tauth_name.enter().append('span')\r\n\t\t\t\t\t.classed('auth_name',true);\r\n\t\t\t\tauth_name\r\n\t\t\t\t\t.attr('class',function(d){\r\n\t\t\t\t\t\treturn 'auth_name ' +d.AuthorID;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.style('width','100%')\r\n\t\t\t\t\t.style('padding-top','0')\r\n\t\t\t\t\t.text(function(d){\r\n\t\t\t\t\t\tvar str = ''; \r\n\t\t\t\t\t\tif(self.data.authors[d.AuthorID]){\r\n\t\t\t\t\t\t\tstr = self.data.authors[d.AuthorID].name;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn str;\r\n\t\t\t\t\t});\r\n\t\t\t\tauth_name.exit().remove();\r\n\t\t\t\tauth_desc = auth_div\r\n\t\t\t\t\t.selectAll('span.auth_desc')\r\n\t\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\t\tauth_desc.enter().append('span')\r\n\t\t\t\t\t.classed('auth_desc',true);\r\n\t\t\t\tauth_desc\r\n\t\t\t\t\t.html(function(d){\r\n\t\t\t\t\t\tvar str_date = d.date,\r\n\t\t\t\t\t\t\tstr_pl_1 = '',\r\n\t\t\t\t\t\t\tstr_pl_2 = '',\r\n\r\n\t\t\t\t\t\t\tdpt = d.DptCiCo.split('_').join(', '),\r\n\t\t\t\t\t\t\tarr = d.ArCiCo.split('_').join(', ');\r\n\r\n\t\t\t\t\t\t//date formatting\r\n\t\t\t\t\t\tif(d.specificity === 'D'){\r\n\t\t\t\t\t\t\tstr_date = d.date;\r\n\t\t\t\t\t\t} else if(d.specificity === 'M'){\r\n\t\t\t\t\t\t\tvar dd = d.date.split('-');\r\n\t\t\t\t\t\t\tstr_date = [dd[0],dd[1]].join('-');\r\n\t\t\t\t\t\t} else if(d.specificity === 'Y'){\r\n\t\t\t\t\t\t\tvar dd = d.date.split('-');\r\n\t\t\t\t\t\t\tstr_date = dd[0];\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t//journey formatting\r\n\t\t\t\t\t\tif(d.ArCiCo === self.focus.place || self.focus.place === null){\r\n\t\t\t\t\t\t\tstr_pl_1 = \"<span>\" +dpt +\"</span>\";\r\n\t\t\t\t\t\t\tstr_pl_2 = \"<span class='focus'>\" +arr +\"</span>\";\r\n\t\t\t\t\t\t} else if(d.DptCiCo === self.focus.place || self.focus.place === null){\r\n\t\t\t\t\t\t\tstr_pl_1 = \"<span class='focus'>\" +dpt +\"</span>\";\r\n\t\t\t\t\t\t\tstr_pl_2 = \"<span>\" +arr +\"</span>\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn \"<div class='sidebar_date'>\" +str_date +\"</div><div class='journey'>\" +str_pl_1 +\"<span>&nbsp;&rarr;&nbsp;</span>\" +str_pl_2 +\"</div>\";\r\n\t\t\t\t\t});\r\n\t\t\t\tauth_desc.exit().remove();\r\n\t\t\t}\r\n\r\n\t\t\tfunction showAuthors(){\r\n\r\n\t\t\t\t//show all authors possible to view\r\n\t\t\t\tvar author_arr = d3.entries(self.data.authors);\r\n\t\t\t\t\r\n\t\t\t\tauth_div = nav_auth\r\n\t\t\t\t\t.selectAll('div.auth_div')\r\n\t\t\t\t\t.data(author_arr);\r\n\t\t\t\tauth_div.enter().append('div')\r\n\t\t\t\t\t.classed('auth_div',true);\r\n\t\t\t\tauth_div.exit().remove();\r\n\t\t\t\tauth_input = auth_div\r\n\t\t\t\t\t.selectAll('input.auth_input')\r\n\t\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\t\tauth_input.enter().append('input')\r\n\t\t\t\t\t.classed('auth_input',true);\r\n\t\t\t\tauth_input\r\n\t\t\t\t\t.attr('type','checkbox')\r\n\t\t\t\t\t.property('checked',function(d){ \r\n\t\t\t\t\t\treturn self.visible_authors.indexOf(d.key) >-1;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.style('display','block')\r\n\t\t\t\t\t;\r\n\t\t\t\tauth_input\r\n\t\t\t\t\t.on('click',function(d){\r\n\t\t\t\t\t\tif(this.checked){\r\n\t\t\t\t\t\t\tself.visible_authors.push(d.key);\r\n\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\tself.visible_authors = self.visible_authors.filter(function(_d){ return _d !== d.key; });\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tself.update();\r\n\t\t\t\t\t\td3.event.stopPropagation();\r\n\t\t\t\t\t});\r\n\t\t\t\tauth_input.exit().remove();\r\n\t\t\t\tauth_name = auth_div\r\n\t\t\t\t\t.selectAll('span.auth_name')\r\n\t\t\t\t\t.data(function(d){ return [d]; });\r\n\t\t\t\tauth_name.enter().append('span')\r\n\t\t\t\t\t.classed('auth_name',true);\r\n\t\t\t\tauth_name\r\n\t\t\t\t\t.attr('class',function(d){\r\n\t\t\t\t\t\treturn 'auth_name ' +d.key;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.style('width','auto')\r\n\t\t\t\t\t.style('padding-top','3px')\r\n\t\t\t\t\t.text(function(d){\r\n\t\t\t\t\t\tvar str = ''; \r\n\t\t\t\t\t\tif(self.data.authors[d.key]){\r\n\t\t\t\t\t\t\tstr = self.data.authors[d.key].name;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn str;\r\n\t\t\t\t\t});\r\n\t\t\t\tauth_name.exit().remove();\r\n\r\n\t\t\t\t//unneeded\r\n\t\t\t\tauth_desc = auth_div.selectAll('span.auth_desc').remove();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t//filter data based on state of navigation\r\n\t\tfilterData:function(){\r\n\t\t\tvar self = vis;\r\n\t\t\tvar refresh = true;\r\n\r\n\t\t\tself.trajectories = [];\r\n\t\t\tself.intersections = {};\r\n\t\t\tself.intersections_journeys = {};\r\n\r\n\t\t\tself.date.start = new Date(self.dt_cur_from || self.dt_from);\r\n\t\t\tself.date.end = new Date(self.dt_cur_to || self.dt_to);\r\n\r\n\t\t\t//convert dates to timestamps\r\n\t\t\tvar tStamp_start = self.date.start.getTime(),\r\n\t\t\t\ttStamp_end = self.date.end.getTime();\r\n\r\n\t\t\t//if initial load, add all authors to visible authors array\r\n\t\t\tif(self.init){\r\n\t\t\t\tself.init = false;\r\n\t\t\t\td3.keys(self.data.authors).forEach(function(d){ self.visible_authors.push(d); });\r\n\t\t\t}\r\n\r\n\t\t\t//filter intersections (points) first\r\n\t\t\td3.keys(self.data.intersections).forEach(function(d,i){\r\n\r\n\t\t\t\t//get timestamp of current data point\r\n\t\t\t\tvar tStamp_currentDatum = new Date(d).getTime();\r\n\r\n\t\t\t\t//only pull elements after the start date and before the end date\r\n\t\t\t\tif(tStamp_currentDatum >=tStamp_start && tStamp_currentDatum <=tStamp_end){\r\n\r\n\t\t\t\t\td3.keys(self.data.intersections[d]).forEach(function(_d,_i){\r\n\r\n\t\t\t\t\t\tif(!self.intersections[_d]){ \r\n\t\t\t\t\t\t\tself.intersections[_d] = []; \r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tself.data.intersections[d][_d].forEach(function(__d,__i){\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tvar val_map = {\r\n\t\t\t\t\t\t\t\t\t\"Y\":0,\r\n\t\t\t\t\t\t\t\t\t\"M\":1,\r\n\t\t\t\t\t\t\t\t\t\"D\":2\r\n\t\t\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t\t//note to EF: it's been a while, but you actually wrote this part, not me!\r\n\t\t\t\t\t\t\tvar authorVisible,\r\n\t\t\t\t\t\t\t\tauthorAccountedFor,\r\n\t\t\t\t\t\t\t\tauthorFilteredList;\r\n\r\n\t\t\t\t\t\t\t//check if author is in visible_authors list\r\n\t\t\t\t\t\t\tauthorVisible = self.visible_authors.indexOf(__d['AuthorID']) >-1;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t//return a list of authors in this place-array that match the current author\r\n\t\t\t\t\t\t\t//(the length of this list should never be above 1)\r\n\t\t\t\t\t\t\tauthorFilteredList = self.intersections[_d].filter(function(a){ \r\n\t\t\t\t\t\t\t\treturn (a['AuthorID'] === __d['AuthorID']);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t//the author is accounted for if the returned list has a length greater than zero\r\n\t\t\t\t\t\t\tauthorAccountedFor = authorFilteredList && authorFilteredList.length >0;\r\n\r\n\t\t\t\t\t\t\t//if the author is NOT accounted for, account for it by adding it to the array\r\n\t\t\t\t\t\t\t//(it will be returned in the filtered list the next time this author ID is searched)\r\n\t\t\t\t\t\t\tif(authorVisible && !authorAccountedFor){\r\n\t\t\t\t\t\t\t\tself.intersections[_d].push(__d);\r\n\t\t\t\t\t\t\t} else if(authorVisible){\r\n\r\n\t\t\t\t\t\t\t\t//if the author IS accounted for, but at a lower level of specificity, up the level of specificity\r\n\t\t\t\t\t\t\t\tif(val_map[authorFilteredList[0].specificity] >val_map[__d.specificity]){\r\n\t\t\t\t\t\t\t\t\tauthorFilteredList[0].specificity = __d.specificity;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t//create empty array to keep track of DptCiCo_ArCiCo pairs\r\n\t\t\tplacePairs = [];\r\n\r\n\t\t\t//filter trajectories next\r\n\t\t\td3.keys(self.data.trajectories).forEach(function(d,i){\r\n\r\n\t\t\t\t//get timestamp of current data point\r\n\t\t\t\tvar tStamp_currentDatum = new Date(d).getTime();\r\n\r\n\t\t\t\t//only pull elements after the start date and before the end date\r\n\t\t\t\tif(tStamp_currentDatum >tStamp_start && tStamp_currentDatum <tStamp_end){\r\n\r\n\t\t\t\t\t//add each trajectory inside each date array to trajectories array\r\n\t\t\t\t\tself.data.trajectories[d].forEach(function(_d,_i){\r\n\r\n\t\t\t\t\t\t//check if author is in visible_authors list\r\n\t\t\t\t\t\tvar authorVisible = self.visible_authors.indexOf(_d['AuthorID']) >-1;\r\n\r\n\t\t\t\t\t\tif(authorVisible){\r\n\t\t\t\t\t\t\t//create variable for trajectory count (to avoid stacking)\r\n\t\t\t\t\t\t\tvar tier = 0;\r\n\r\n\t\t\t\t\t\t\t//concat placepair string\r\n\t\t\t\t\t\t\tvar placePair = [_d.ArCiCo,_d.DptCiCo].join('_');\r\n\t\t\t\r\n\t\t\t\t\t\t\tif(placePairs.indexOf(placePair) <0){\r\n\t\t\t\t\t\t\t\ttier = 0;\r\n\t\t\t\t\t\t\t} else{\r\n\t\t\t\t\t\t\t\ttier = placePairs.filter(function(_d){ return _d === placePair; })[0].length +1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tplacePairs.push(placePair);\r\n\r\n\t\t\t\t\t\t\t_d.tier = tier;\r\n\t\t\t\t\t\t\tself.trajectories.push(_d);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t//add entry to intersections_journeys dataset for the sidebar\r\n\t\t\t\t\tself.data.trajectories[d].forEach(function(_d,_i){\r\n\r\n\t\t\t\t\t\t//check if author is in visible_authors list\r\n\t\t\t\t\t\tvar authorVisible = self.visible_authors.indexOf(_d['AuthorID']) >-1;\r\n\r\n\t\t\t\t\t\tif(authorVisible){\r\n\t\t\t\t\t\t\tvar obj = _d;\r\n\t\t\t\t\t\t\tobj.date = d;\r\n\r\n\t\t\t\t\t\t\tif(!self.intersections_journeys[_d.ArCiCo]){\r\n\t\t\t\t\t\t\t\tself.intersections_journeys[_d.ArCiCo] = [];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(!self.intersections_journeys[_d.DptCiCo]){\r\n\t\t\t\t\t\t\t\tself.intersections_journeys[_d.DptCiCo] = [];\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t//add entry to the 'journeys' dataset for the departing city\r\n\t\t\t\t\t\t\tself.intersections_journeys[_d.ArCiCo].push(obj);\r\n\r\n\t\t\t\t\t\t\t//add entry to the 'journeys' dataset for the arriving city\r\n\t\t\t\t\t\t\tself.intersections_journeys[_d.DptCiCo].push(obj);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\r\n\t\t//puts data in correct format\r\n\t\tprocessData:function(){\r\n\t\t\tvar self = vis;\r\n\r\n\t\t\t//any data transformation logic goes here\r\n\r\n\t\t\tself.filterData();\r\n\t\t\tself.generate();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar vis = init();\r\nvis.generateDateSlider();\r\nvis.getData(vis.processData);\r\n"]}